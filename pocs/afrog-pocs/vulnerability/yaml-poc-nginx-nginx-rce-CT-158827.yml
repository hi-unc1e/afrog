name: yaml-poc-xp-phpstudy-rce-CT-158827
binding: 87690e8d-f967-4c76-9fd7-e8c77a6ab094
detail:
    author: luhan.xu
    vulnerability:
        id: b83d4697-1d06-4167-95da-bed783f8cea4
        level: high
    warning: Harmless
transport: http
set:
    name: randomInt(10000000, 99999999)
rules:
    check:
        request:
            cache: true
            method: GET
            path: /
            follow_redirects: false
        expression: versionIn("nginx/(?P<version>[\\d\\.]*)".submatch(response.headers["Server"])["version"], ">=0.8.41, <1.4.3") || versionIn("nginx/(?P<version>[\\d\\.]*)".submatch(response.headers["Server"])["version"], ">=1.5.0, <1.5.7") || "nginx$".matches(response.headers["Server"]) || " nginx ".matches(response.headers["Server"])
    html0:
        request:
            cache: true
            method: GET
            path: /{{name}}.php
            follow_redirects: false
        expression: response.status != 200
    html1:
        request:
            cache: true
            method: GET
            path: /index.html
            follow_redirects: false
        expression: response.status == 200 && response.headers["Server"].contains("nginx")
    html2:
        request:
            cache: true
            method: GET
            path: /index.html/.php
            follow_redirects: false
        expression: response.status == 200 && response.headers["Server"].contains("nginx")
    html3:
        request:
            cache: true
            method: GET
            path: /{{name}}.html/.php
            follow_redirects: false
        expression: response.status != 200
    html4:
        request:
            cache: true
            method: GET
            path: /index.html/.xxx
            follow_redirects: false
        expression: response.status != 200
    php0:
        request:
            cache: true
            method: GET
            path: /{{name}}.php
            follow_redirects: false
        expression: response.status != 200
    php1:
        request:
            cache: true
            method: GET
            path: /index.php
            follow_redirects: false
        expression: response.status == 200 && response.headers["Server"].contains("nginx")
    php2:
        request:
            cache: true
            method: GET
            path: /index.php/.php
            follow_redirects: false
        expression: response.status == 200 && response.headers["Server"].contains("nginx")
    php3:
        request:
            cache: true
            method: GET
            path: /{{name}}.php/.xxx
            follow_redirects: false
        expression: response.status != 200
    php4:
        request:
            cache: true
            method: GET
            path: /index.php/.xxx
            follow_redirects: false
        expression: response.status != 200
expression: check() && (html0() && html1() && html2() && html3() && html4() || php0() && php1() && php2() && php3() && php4())
