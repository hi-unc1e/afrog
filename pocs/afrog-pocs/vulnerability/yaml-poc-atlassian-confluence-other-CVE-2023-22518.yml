name: yaml-poc-atlassian-confluence-other-CVE-2023-22518
binding: 054308ec-8723-4c86-8262-249ffbeef8bc
detail:
    author: yuxiang.cai
    links:
        - https://avd.aliyun.com/detail?id=AVD-2023-22518
        - https://confluence.atlassian.com/pages/viewpage.action?pageId=1311473907
        - https://confluence.atlassian.com/security/cve-2023-22518-improper-authorization-vulnerability-in-confluence-data-center-and-server-1311473907.html
        - https://github.com/RootUp/PersonalStuff/blob/master/check_cve_2023_22518.py
        - https://github.com/projectdiscovery/nuclei-templates/blob/main/http/cves/2023/CVE-2023-22518.yaml
        - https://jira.atlassian.com/browse/CONFSERVER-93142
        - https://www.bleepingcomputer.com/news/security/atlassian-warns-of-exploit-for-confluence-data-wiping-bug-get-patching/
        - https://www.rapid7.com/blog/post/2023/11/06/etr-rapid7-observed-exploitation-of-atlassian-confluence-cve-2023-22518/
        - https://www.securityweek.com/exploitation-of-critical-confluence-vulnerability-begins/
    vulnerability:
        id: 66fafe46-3c4d-4836-973f-073c60a7dcd7
        level: critical
    warning: Harmless
transport: http
set:
    random: randomLowercase(15)
rules:
    r0:
        request:
            cache: true
            method: POST
            path: /json/setup-restore.action
            headers:
                Content-Type: multipart/form-data; boundary=----{{random}}
        expression: response.body_string.contains('buildIndexLocalFileRestore') || response.body_string.contains('setup-restore-local.action')
expression: r0()
